(()=>{var e={};e.id=966,e.ids=[966],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},1808:e=>{"use strict";e.exports=require("net")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},4493:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>o.a,__next_app__:()=>d,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>h}),i(4684),i(9128),i(5866);var n=i(3191),r=i(8716),s=i(7922),o=i.n(s),a=i(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);i.d(t,l);let h=["",{children:["signup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,4684)),"C:\\Users\\arman\\Desktop\\CAPSTONE\\iSommelier\\app\\signup\\page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(i.bind(i,9128)),"C:\\Users\\arman\\Desktop\\CAPSTONE\\iSommelier\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["C:\\Users\\arman\\Desktop\\CAPSTONE\\iSommelier\\app\\signup\\page.js"],u="/signup/page",d={require:i,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/signup/page",pathname:"/signup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:h}})},2409:(e,t,i)=>{Promise.resolve().then(i.bind(i,3012)),Promise.resolve().then(i.t.bind(i,9404,23))},238:(e,t,i)=>{Promise.resolve().then(i.bind(i,9950))},6346:(e,t,i)=>{Promise.resolve().then(i.t.bind(i,2994,23)),Promise.resolve().then(i.t.bind(i,6114,23)),Promise.resolve().then(i.t.bind(i,9727,23)),Promise.resolve().then(i.t.bind(i,9671,23)),Promise.resolve().then(i.t.bind(i,1868,23)),Promise.resolve().then(i.t.bind(i,4759,23))},9950:(e,t,i)=>{"use strict";let n,r,s,o,a,l,h,c,u,d,p,f,_,m,g,y,v;i.r(t),i.d(t,{default:()=>oo});var b,w,C,E=i(326),S=i(7577),I=i(5047);let x={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},T=function(e,t){if(!e)throw k(t)},k=function(e){return Error("Firebase Database ("+x.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},N=function(e){let t=[],i=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:((64512&r)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++n)),t[i++]=r>>18|240,t[i++]=r>>12&63|128):t[i++]=r>>12|224,t[i++]=r>>6&63|128),t[i++]=63&r|128)}return t},P=function(e){let t=[],i=0,n=0;for(;i<e.length;){let r=e[i++];if(r<128)t[n++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[i++];t[n++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[i++],o=e[i++];t[n++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},O={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,c=(3&r)<<4|o>>4,u=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(u=64)),n.push(i[h],i[c],i[u],i[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(N(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):P(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let i=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let r=i[e.charAt(t++)],s=t<e.length?i[e.charAt(t)]:0,o=++t<e.length?i[e.charAt(t)]:64,a=++t<e.length?i[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new R;let l=r<<2|s>>4;if(n.push(l),64!==o){let e=s<<4&240|o>>2;if(n.push(e),64!==a){let e=o<<6&192|a;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class R extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let D=function(e){let t=N(e);return O.encodeByteArray(t,!0)},A=function(e){return D(e).replace(/\./g,"")},M=function(e){try{return O.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},L=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,F=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},q=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&M(e[1]);return t&&JSON.parse(t)},U=()=>{try{return L()||F()||q()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},j=e=>{var t,i;return null===(i=null===(t=U())||void 0===t?void 0:t.emulatorHosts)||void 0===i?void 0:i[e]},B=e=>{let t=j(e);if(!t)return;let i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(i+1),10);return"["===t[0]?[t.substring(1,i-1),n]:[t.substring(0,i),n]},H=()=>{var e;return null===(e=U())||void 0===e?void 0:e.config};class W{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,i))}}}function z(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function V(){return!0===x.NODE_CLIENT||!0===x.NODE_ADMIN}function $(){try{return"object"==typeof indexedDB}catch(e){return!1}}function K(){return new Promise((e,t)=>{try{let i=!0,n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),i||self.indexedDB.deleteDatabase(n),e(!0)},r.onupgradeneeded=()=>{i=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}class G extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,G.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Y.prototype.create)}}class Y{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},n=`${this.service}/${e}`,r=this.errors[e],s=r?r.replace(Q,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`}):"Error",o=`${this.serviceName}: ${s} (${n}).`;return new G(n,o,i)}}let Q=/\{\$([^}]+)}/g;function J(e){return JSON.parse(e)}function Z(e){return JSON.stringify(e)}let X=function(e){let t={},i={},n={},r="";try{let s=e.split(".");t=J(M(s[0])||""),i=J(M(s[1])||""),r=s[2],n=i.d||{},delete i.d}catch(e){}return{header:t,claims:i,data:n,signature:r}},ee=function(e){let t=X(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},et=function(e){let t=X(e).claims;return"object"==typeof t&&!0===t.admin};function ei(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function en(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function er(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function es(e,t,i){let n={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=t.call(i,e[r],r,e));return n}function eo(e,t){if(e===t)return!0;let i=Object.keys(e),n=Object.keys(t);for(let r of i){if(!n.includes(r))return!1;let i=e[r],s=t[r];if(ea(i)&&ea(s)){if(!eo(i,s))return!1}else if(i!==s)return!1}for(let e of n)if(!i.includes(e))return!1;return!0}function ea(e){return null!==e&&"object"==typeof e}class el{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){let i,n;t||(t=0);let r=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)r[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)r[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=l^o&(a^l),n=1518500249):(i=o^a^l,n=1859775393):e<60?(i=o&a|l&(o|a),n=2400959708):(i=o^a^l,n=3395469782);let t=(s<<5|s>>>27)+i+h+n+r[e]&4294967295;h=l,l=a,a=(o<<30|o>>>2)&4294967295,o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let i=t-this.blockSize,n=0,r=this.buf_,s=this.inbuf_;for(;n<t;){if(0===s)for(;n<=i;)this.compress_(e,n),n+=this.blockSize;if("string"==typeof e){for(;n<t;)if(r[s]=e.charCodeAt(n),++s,++n,s===this.blockSize){this.compress_(r),s=0;break}}else for(;n<t;)if(r[s]=e[n],++s,++n,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let i=0;for(let t=0;t<5;t++)for(let n=24;n>=0;n-=8)e[i]=this.chain_[t]>>n&255,++i;return e}}function eh(e,t){return`${e} failed: ${t} argument `}let ec=function(e){let t=[],i=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r>=55296&&r<=56319){let t=r-55296;T(++n<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(n)-56320)}r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return t},eu=function(e){let t=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t++:n<2048?t+=2:n>=55296&&n<=56319?(t+=4,i++):t+=3}return t};function ed(e,t=1e3,i=2){let n=t*Math.pow(i,e);return Math.min(144e5,n+Math.round(.5*n*(Math.random()-.5)*2))}function ep(e){return e&&e._delegate?e._delegate:e}x.NODE_CLIENT=!0;class ef{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let e_="[DEFAULT]";class em{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new W;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&e.resolve(i)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(e){if(n)return null;throw e}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:e_})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:i});t.resolve(e)}catch(e){}}}}clearInstance(e=e_){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=e_){return this.instances.has(e)}getOptions(e=e_){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[e,t]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var i;let n=this.normalizeInstanceIdentifier(t),r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);let s=this.instances.get(n);return s&&e(s,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let n of i)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:e===e_?void 0:e,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}return i||null}normalizeInstanceIdentifier(e=e_){return this.component?this.component.multipleInstances?e:e_:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eg{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new em(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ey=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(w||(w={}));let ev={debug:w.DEBUG,verbose:w.VERBOSE,info:w.INFO,warn:w.WARN,error:w.ERROR,silent:w.SILENT},eb=w.INFO,ew={[w.DEBUG]:"log",[w.VERBOSE]:"log",[w.INFO]:"info",[w.WARN]:"warn",[w.ERROR]:"error"},eC=(e,t,...i)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),r=ew[t];if(r)console[r](`[${n}]  ${e.name}:`,...i);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eE{constructor(e){this.name=e,this._logLevel=eb,this._logHandler=eC,this._userLogHandler=null,ey.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in w))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ev[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,w.DEBUG,...e),this._logHandler(this,w.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,w.VERBOSE,...e),this._logHandler(this,w.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,w.INFO,...e),this._logHandler(this,w.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,w.WARN,...e),this._logHandler(this,w.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,w.ERROR,...e),this._logHandler(this,w.ERROR,...e)}}let eS=(e,t)=>t.some(t=>e instanceof t),eI=new WeakMap,ex=new WeakMap,eT=new WeakMap,ek=new WeakMap,eN=new WeakMap,eP={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return ex.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eT.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return eO(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eO(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,i)=>{let n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(eO(e.result)),n()},s=()=>{i(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&eI.set(t,e)}).catch(()=>{}),eN.set(t,e),t}(e);if(ek.has(e))return ek.get(e);let i="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(eR(this),e),eO(eI.get(this))}:function(...e){return eO(t.apply(eR(this),e))}:function(e,...i){let n=t.call(eR(this),e,...i);return eT.set(n,e.sort?e.sort():[e]),eO(n)}:(t instanceof IDBTransaction&&function(e){if(ex.has(e))return;let t=new Promise((t,i)=>{let n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),n()},s=()=>{i(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});ex.set(e,t)}(t),eS(t,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,eP):t;return i!==e&&(ek.set(e,i),eN.set(i,e)),i}let eR=e=>eN.get(e);function eD(e,t,{blocked:i,upgrade:n,blocking:r,terminated:s}={}){let o=indexedDB.open(e,t),a=eO(o);return n&&o.addEventListener("upgradeneeded",e=>{n(eO(o.result),e.oldVersion,e.newVersion,eO(o.transaction),e)}),i&&o.addEventListener("blocked",e=>i(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}let eA=["get","getKey","getAll","getAllKeys","count"],eM=["put","add","delete","clear"],eL=new Map;function eF(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eL.get(t))return eL.get(t);let i=t.replace(/FromIndex$/,""),n=t!==i,r=eM.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!(r||eA.includes(i)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return n&&(o=o.index(t.shift())),(await Promise.all([o[i](...t),r&&s.done]))[0]};return eL.set(t,s),s}eP={...v=eP,get:(e,t,i)=>eF(e,t)||v.get(e,t,i),has:(e,t)=>!!eF(e,t)||v.has(e,t)};class eq{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eU="@firebase/app",ej="0.10.11",eB=new eE("@firebase/app"),eH="[DEFAULT]",eW={[eU]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ez=new Map,eV=new Map,e$=new Map;function eK(e,t){try{e.container.addComponent(t)}catch(i){eB.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,i)}}function eG(e){let t=e.name;if(e$.has(t))return eB.debug(`There were multiple attempts to register component ${t}.`),!1;for(let i of(e$.set(t,e),ez.values()))eK(i,e);for(let t of eV.values())eK(t,e);return!0}function eY(e,t){let i=e.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),e.container.getProvider(t)}let eQ=new Y("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eJ{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ef("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eQ.create("app-deleted",{appName:this._name})}}function eZ(e,t={}){let i=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:eH,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw eQ.create("bad-app-name",{appName:String(r)});if(i||(i=H()),!i)throw eQ.create("no-options");let s=ez.get(r);if(s){if(eo(i,s.options)&&eo(n,s.config))return s;throw eQ.create("duplicate-app",{appName:r})}let o=new eg(r);for(let e of e$.values())o.addComponent(e);let a=new eJ(i,n,o);return ez.set(r,a),a}function eX(e,t,i){var n;let r=null!==(n=eW[e])&&void 0!==n?n:e;i&&(r+=`-${i}`);let s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eB.warn(e.join(" "));return}eG(new ef(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}let e0="firebase-heartbeat-store",e1=null;function e2(){return e1||(e1=eD("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e0)}catch(e){console.warn(e)}}}).catch(e=>{throw eQ.create("idb-open",{originalErrorMessage:e.message})})),e1}async function e3(e){try{let t=(await e2()).transaction(e0),i=await t.objectStore(e0).get(e6(e));return await t.done,i}catch(e){if(e instanceof G)eB.warn(e.message);else{let t=eQ.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eB.warn(t.message)}}}async function e4(e,t){try{let i=(await e2()).transaction(e0,"readwrite"),n=i.objectStore(e0);await n.put(t,e6(e)),await i.done}catch(e){if(e instanceof G)eB.warn(e.message);else{let t=eQ.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eB.warn(t.message)}}}function e6(e){return`${e.name}!${e.options.appId}`}class e8{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new e9(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=e5();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;return this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(e){eB.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=e5(),{heartbeatsToSend:i,unsentEntries:n}=function(e,t=1024){let i=[],n=e.slice();for(let r of e){let e=i.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),e7(i)>t){e.dates.pop();break}}else if(i.push({agent:r.agent,dates:[r.date]}),e7(i)>t){i.pop();break}n=n.slice(1)}return{heartbeatsToSend:i,unsentEntries:n}}(this._heartbeatsCache.heartbeats),r=A(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return eB.warn(e),""}}}function e5(){return new Date().toISOString().substring(0,10)}class e9{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!$()&&K().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e3(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return e4(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let i=await this.read();return e4(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}}}function e7(e){return A(JSON.stringify({version:2,heartbeats:e})).length}eG(new ef("platform-logger",e=>new eq(e),"PRIVATE")),eG(new ef("heartbeat",e=>new e8(e),"PRIVATE")),eX(eU,ej,""),eX(eU,ej,"esm2017"),eX("fire-js",""),eX("firebase","10.13.2","app");var te=i(3968);let tt=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ti="websocket",tn="long_polling";class tr{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Z(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:J(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ts{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return ei(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let to=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tr(t)}}catch(e){}return new ts},ta=to("localStorage"),tl=to("sessionStorage"),th=new eE("@firebase/database"),tc=function(){let e=1;return function(){return e++}}(),tu=function(e){let t=ec(e),i=new el;i.update(t);let n=i.digest();return O.encodeByteArray(n)},td=function(...e){let t="";for(let i=0;i<e.length;i++){let n=e[i];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=td.apply(null,n):"object"==typeof n?t+=Z(n):t+=n,t+=" "}return t},tp=null,tf=!0,t_=function(e,t){T(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(th.logLevel=w.VERBOSE,tp=th.log.bind(th),t&&tl.set("logging_enabled",!0)):"function"==typeof e?tp=e:(tp=null,tl.remove("logging_enabled"))},tm=function(...e){if(!0===tf&&(tf=!1,null===tp&&!0===tl.get("logging_enabled")&&t_(!0)),tp){let t=td.apply(null,e);tp(t)}},tg=function(e){return function(...t){tm(e,...t)}},ty=function(...e){let t="FIREBASE INTERNAL ERROR: "+td(...e);th.error(t)},tv=function(...e){let t=`FIREBASE FATAL ERROR: ${td(...e)}`;throw th.error(t),Error(t)},tb=function(...e){let t="FIREBASE WARNING: "+td(...e);th.warn(t)},tw=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&tb("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},tC=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},tE=function(e){if(V()||"complete"===document.readyState)e();else{let t=!1,i=function(){if(!document.body){setTimeout(i,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&i()}),window.attachEvent("onload",i))}},tS="[MIN_NAME]",tI="[MAX_NAME]",tx=function(e,t){if(e===t)return 0;if(e===tS||t===tI)return -1;if(t===tS||e===tI)return 1;{let i=tA(e),n=tA(t);return null!==i?null!==n?i-n==0?e.length-t.length:i-n:-1:null!==n?1:e<t?-1:1}},tT=function(e,t){return e===t?0:e<t?-1:1},tk=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+Z(t))},tN=function(e){if("object"!=typeof e||null===e)return Z(e);let t=[];for(let i in e)t.push(i);t.sort();let i="{";for(let n=0;n<t.length;n++)0!==n&&(i+=","),i+=Z(t[n])+":"+tN(e[t[n]]);return i+"}"},tP=function(e,t){let i=e.length;if(i<=t)return[e];let n=[];for(let r=0;r<i;r+=t)r+t>i?n.push(e.substring(r,i)):n.push(e.substring(r,r+t));return n};function tO(e,t){for(let i in e)e.hasOwnProperty(i)&&t(i,e[i])}let tR=function(e){let t,i,n,r,s;T(!tC(e),"Invalid JSON number"),0===e?(i=0,n=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(i=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,n=Math.round(e*Math.pow(2,52-r)-4503599627370496)):(i=0,n=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);for(s=11;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);o.push(t?1:0),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},tD=RegExp("^-?(0*)\\d{1,10}$"),tA=function(e){if(tD.test(e)){let t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},tM=function(e){try{e()}catch(e){setTimeout(()=>{throw tb("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},tL=function(e,t){let i=setTimeout(e,t);return"number"==typeof i&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(i):"object"==typeof i&&i.unref&&i.unref(),i};class tF{constructor(e,t,i,n,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=n,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ta.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ta.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function tq(e,t,i){let n;if(T("string"==typeof t,"typeof type must == string"),T("object"==typeof i,"typeof params must == object"),t===ti)n=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===tn)n=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(i.ns=e.namespace);let r=[];return tO(i,(e,t)=>{r.push(e+"="+t)}),n+r.join("&")}class tU{constructor(){this.counters_={}}incrementCounter(e,t=1){ei(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,i){if(!(i instanceof Object))return i;switch(i.constructor){case Date:return new Date(i.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return i}for(let n in i)i.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=e(t[n],i[n]));return t}(void 0,this.counters_)}}let tj={},tB={};function tH(e){let t=e.toString();return tj[t]||(tj[t]=new tU),tj[t]}let tW="",tz=null;"undefined"!=typeof MozWebSocket?tz=MozWebSocket:"undefined"!=typeof WebSocket&&(tz=WebSocket);class tV{constructor(e,t,i,n,r,s,o){this.connId=e,this.applicationId=i,this.appCheckToken=n,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=tg(this.connId),this.stats_=tH(t),this.connURL=tV.connectionURL_(t,s,o,n,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,n,r){let s={};return s.v="5",!V()&&"undefined"!=typeof location&&location.hostname&&tt.test(location.hostname)&&(s.r="f"),t&&(s.s=t),i&&(s.ls=i),n&&(s.ac=n),r&&(s.p=r),tq(e,ti,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ta.set("previous_websocket_failure",!0);try{let e;if(V()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tW}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let i=process.env,n=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;n&&(e.proxy={origin:n})}this.mySock=new tz(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){tV.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==tz&&!tV.forceDisallow_}static previouslyFailed(){return ta.isInMemoryStorage||!0===ta.get("previous_websocket_failure")}markConnectionHealthy(){ta.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=J(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(T(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=Z(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=tP(t,16384);i.length>1&&this.sendString_(String(i.length));for(let e=0;e<i.length;e++)this.sendString_(i[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}tV.responsesRequiredToBeHealthy=2,tV.healthyTimeout=3e4;let t$="@firebase/database",tK="1.0.8";class tG{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){tb(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class tY{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(tm("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tb(e)}}class tQ{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}tQ.OWNER="owner";class tJ{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&tM(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let tZ="start";class tX{constructor(e,t,i,n,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=n,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=tg(e),this.stats_=tH(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),tq(t,tn,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tJ(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),tE(()=>{if(this.isClosed_)return;this.scriptTagHolder=new t0((...e)=>{let[t,i,n,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder){if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===tZ)this.id=i,this.password=n;else if("close"===t)i?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(i,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)}},(...e)=>{let[t,i]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,i)},()=>{this.onClosed_()},this.urlFn);let e={};e[tZ]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&tt.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){tX.forceAllow_=!0}static forceDisallow(){tX.forceDisallow_=!0}static isAvailable(){return!V()&&(!!tX.forceAllow_||!tX.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Z(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=tP(D(t),1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(V())return;this.myDisconnFrame=document.createElement("iframe");let i={};i.dframe="t",i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Z(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class t0{constructor(e,t,i,n){if(this.onDisconnect=i,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,V())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=tc(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=t0.createIFrame_();let i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(i='<script>document.domain="'+document.domain+'";</script>');let n="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(e){tm("frame writing exception"),e.stack&&tm(e.stack),tm(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tm("No IE domain setting required")}catch(i){let t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",n=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+i.length<=1870){let e=this.pendingSegs.shift();i=i+"&seg"+n+"="+e.seg+"&ts"+n+"="+e.ts+"&d"+n+"="+e.d,n++}else break;return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},n=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(n),i()})}addTag(e,t){V()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let e=i.readyState;e&&"loaded"!==e&&"complete"!==e||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{tm("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch(e){}},Math.floor(1))}}class t1{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[tX,tV]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let t=tV&&tV.isAvailable(),i=t&&!tV.previouslyFailed();if(e.webSocketOnly&&(t||tb("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[tV];else{let e=this.transports_=[];for(let t of t1.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);t1.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t1.globalTransportInitialized_=!1;class t2{constructor(e,t,i,n,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=n,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=tg("c:"+this.id+":"),this.transportManager_=new t1(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=tL(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=tk("t",e),i=tk("d",e);if("c"===t)this.onSecondaryControl_(i);else if("d"===t)this.pendingDataMessages.push(i);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=tk("t",e),i=tk("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=tk("t",e);if("d"in e){let i=e.d;if("h"===t){let e=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?ty("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ty("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,n=e.h;this.sessionId=e.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&tb("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),tL(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):tL(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ta.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class t3{put(e,t,i,n){}merge(e,t,i,n){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class t4{constructor(e){this.allowedEvents_=e,this.listeners_={},T(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let e=0;e<i.length;e++)i[e].callback.apply(i[e].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let n=this.getInitialEvent(e);n&&t.apply(i,n)}off(e,t,i){this.validateEventType_(e);let n=this.listeners_[e]||[];for(let e=0;e<n.length;e++)if(n[e].callback===t&&(!i||i===n[e].context)){n.splice(e,1);return}}validateEventType_(e){T(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class t6 extends t4{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||z()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new t6}getInitialEvent(e){return T("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class t8{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function t5(){return new t8("")}function t9(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function t7(e){return e.pieces_.length-e.pieceNum_}function ie(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new t8(e.pieces_,t)}function it(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ii(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ir(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let i=e.pieceNum_;i<e.pieces_.length-1;i++)t.push(e.pieces_[i]);return new t8(t,0)}function is(e,t){let i=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)i.push(e.pieces_[t]);if(t instanceof t8)for(let e=t.pieceNum_;e<t.pieces_.length;e++)i.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&i.push(e[t])}return new t8(i,0)}function io(e){return e.pieceNum_>=e.pieces_.length}function ia(e,t){let i=t9(e),n=t9(t);if(null===i)return t;if(i===n)return ia(ie(e),ie(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function il(e,t){let i=ii(e,0),n=ii(t,0);for(let e=0;e<i.length&&e<n.length;e++){let t=tx(i[e],n[e]);if(0!==t)return t}return i.length===n.length?0:i.length<n.length?-1:1}function ih(e,t){if(t7(e)!==t7(t))return!1;for(let i=e.pieceNum_,n=t.pieceNum_;i<=e.pieces_.length;i++,n++)if(e.pieces_[i]!==t.pieces_[n])return!1;return!0}function ic(e,t){let i=e.pieceNum_,n=t.pieceNum_;if(t7(e)>t7(t))return!1;for(;i<e.pieces_.length;){if(e.pieces_[i]!==t.pieces_[n])return!1;++i,++n}return!0}class iu{constructor(e,t){this.errorPrefix_=t,this.parts_=ii(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eu(this.parts_[e]);id(this)}}function id(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+ip(e))}function ip(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class i_ extends t4{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new i_}getInitialEvent(e){return T("visible"===e,"Unknown event type: "+e),[this.visible_]}}class im extends t3{constructor(e,t,i,n,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=n,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=im.nextPersistentConnectionId_++,this.log_=tg("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!V())throw Error("Auth override specified in options, but not supported on non Node.js platforms");i_.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&t6.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){let n=++this.requestNumber_,r={r:n,a:e,b:t};this.log_(Z(r)),T(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[n]=i)}get(e){this.initConnection_();let t=new W,i={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:i,onComplete:e=>{let i=e.d;"ok"===e.s?t.resolve(i):t.reject(i)}}),this.outstandingGetCount_++;let n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),t.promise}listen(e,t,i,n){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),T(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),T(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:n,hashFn:t,query:e,tag:i};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){let t=e.query,i=t._path.toString(),n=t._queryIdentifier;this.log_("Listen on "+i+" for "+n);let r={p:i};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;im.warnOnListenWarnings_(s,t),(this.listens.get(i)&&this.listens.get(i).get(n))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(i,n),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&ei(e,"w")){let i=en(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();tb(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||et(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ee(e)?"auth":"gauth",i={cred:e};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(t,i,t=>{let i=t.s,n=t.d||"error";this.authToken_===e&&("ok"===i?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,i=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){let i=e._path.toString(),n=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+n),T(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,n)&&this.connected_&&this.sendUnlisten_(i,n,e._queryObject,t)}sendUnlisten_(e,t,i,n){this.log_("Unlisten on "+e+" for "+t);let r={p:e};n&&(r.q=i,r.t=n),this.sendRequest("n",r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,n){let r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{n&&setTimeout(()=>{n(e.s,e.d)},Math.floor(0))})}put(e,t,i,n){this.putInternal("p",e,t,i,n)}merge(e,t,i,n){this.putInternal("m",e,t,i,n)}putInternal(e,t,i,n,r){this.initConnection_();let s={p:t,d:i};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:n}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(i.s,i.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Z(e));let t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ty("Unrecognized action received from server: "+Z(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){T(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+im.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,i())};this.realtime_={close:a,sendRequest:function(e){T(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?tm("getToken() completed but was canceled"):(tm("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new t2(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,e=>{tb(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&tb(e),a())}}}interrupt(e){tm("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tm("Resuming connection for reason: "+e),delete this.interruptReasons_[e],er(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;i=t?t.map(e=>tN(e)).join("$"):"default";let n=this.removeListen_(e,i);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){let i;let n=new t8(e).toString();if(this.listens.has(n)){let e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){tm("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){tm("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";V()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tW.replace(/\./g,"-")]=1,z()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=t6.getInstance().currentlyOnline();return er(this.interruptReasons_)&&e}}im.nextPersistentConnectionId_=0,im.nextConnectionId_=0;class ig{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new ig(e,t)}}class iy{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new ig(tS,e),n=new ig(tS,t);return 0!==this.compare(i,n)}minPost(){return ig.MIN}}class iv extends iy{static get __EMPTY_NODE(){return s}static set __EMPTY_NODE(e){s=e}compare(e,t){return tx(e.name,t.name)}isDefinedOn(e){throw k("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ig.MIN}maxPost(){return new ig(tI,s)}makePost(e,t){return T("string"==typeof e,"KeyIndex indexValue must always be a string."),new ig(e,s)}toString(){return".key"}}let ib=new iv;class iw{constructor(e,t,i,n,r=null){this.isReverse_=n,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,n&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class iC{constructor(e,t,i,n,r){this.key=e,this.value=t,this.color=null!=i?i:iC.RED,this.left=null!=n?n:iS.EMPTY_NODE,this.right=null!=r?r:iS.EMPTY_NODE}copy(e,t,i,n,r){return new iC(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=n?n:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let n=this,r=i(e,n.key);return(n=r<0?n.copy(null,null,null,n.left.insert(e,t,i),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,i))).fixUp_()}removeMin_(){if(this.left.isEmpty())return iS.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let i,n;if(i=this,0>t(e,i.key))i.left.isEmpty()||i.left.isRed_()||i.left.left.isRed_()||(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),i.right.isEmpty()||i.right.isRed_()||i.right.left.isRed_()||(i=i.moveRedRight_()),0===t(e,i.key)){if(i.right.isEmpty())return iS.EMPTY_NODE;n=i.right.min_(),i=i.copy(n.key,n.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,iC.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,iC.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")}}iC.RED=!0,iC.BLACK=!1;class iE{copy(e,t,i,n,r){return this}insert(e,t,i){return new iC(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class iS{constructor(e,t=iS.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new iS(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,iC.BLACK,null,null))}remove(e){return new iS(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,iC.BLACK,null,null))}get(e){let t;let i=this.root_;for(;!i.isEmpty();){if(0===(t=this.comparator_(e,i.key)))return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,n=null;for(;!i.isEmpty();){if(0===(t=this.comparator_(e,i.key))){if(i.left.isEmpty()){if(n)return n.key;return null}for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(n=i,i=i.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new iw(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new iw(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new iw(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new iw(this.root_,null,this.comparator_,!0,e)}}function iI(e,t){return tx(e.name,t.name)}function ix(e,t){return tx(e,t)}iS.EMPTY_NODE=new iE;let iT=function(e){return"number"==typeof e?"number:"+tR(e):"string:"+e},ik=function(e){if(e.isLeafNode()){let t=e.val();T("string"==typeof t||"number"==typeof t||"object"==typeof t&&ei(t,".sv"),"Priority must be a string or number.")}else T(e===o||e.isEmpty(),"priority of unexpected type.");T(e===o||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class iN{constructor(e,t=iN.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,T(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ik(this.priorityNode_)}static set __childrenNodeConstructor(e){a=e}static get __childrenNodeConstructor(){return a}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new iN(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:iN.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return io(e)?this:".priority"===t9(e)?this.priorityNode_:iN.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:iN.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let i=t9(e);return null===i?t:t.isEmpty()&&".priority"!==i?this:(T(".priority"!==i||1===t7(e),".priority must be the last token in a path"),this.updateImmediateChild(i,iN.__childrenNodeConstructor.EMPTY_NODE.updateChild(ie(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+iT(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=tR(this.value_):e+=this.value_,this.lazyHash_=tu(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===iN.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof iN.__childrenNodeConstructor?-1:(T(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,i=typeof this.value_,n=iN.VALUE_TYPE_ORDER.indexOf(t),r=iN.VALUE_TYPE_ORDER.indexOf(i);return(T(n>=0,"Unknown leaf type: "+t),T(r>=0,"Unknown leaf type: "+i),n!==r)?r-n:"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}iN.VALUE_TYPE_ORDER=["object","boolean","number","string"];class iP extends iy{compare(e,t){let i=e.node.getPriority(),n=t.node.getPriority(),r=i.compareTo(n);return 0===r?tx(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ig.MIN}maxPost(){return new ig(tI,new iN("[PRIORITY-POST]",h))}makePost(e,t){return new ig(t,new iN("[PRIORITY-POST]",l(e)))}toString(){return".priority"}}let iO=new iP,iR=Math.log(2);class iD{constructor(e){this.count=parseInt(Math.log(e+1)/iR,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let iA=function(e,t,i,n){e.sort(t);let r=function(t,n){let s;let o=n-t;if(0===o)return null;if(1===o)return s=e[t],new iC(i?i(s):s,s.node,iC.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,n);return s=e[a],new iC(i?i(s):s,s.node,iC.BLACK,l,h)}};return new iS(n||t,function(t){let n=null,s=null,o=e.length,a=function(t,n){let s=o-t,a=o;o-=t;let h=r(s+1,a),c=e[s];l(new iC(i?i(c):c,c.node,n,null,h))},l=function(e){n?n.left=e:s=e,n=e};for(let e=0;e<t.count;++e){let i=t.nextBitIsOne(),n=Math.pow(2,t.count-(e+1));i?a(n,iC.BLACK):(a(n,iC.BLACK),a(n,iC.RED))}return s}(new iD(e.length)))},iM={};class iL{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return T(iM&&iO,"ChildrenNode.ts has not been loaded"),c=c||new iL({".priority":iM},{".priority":iO})}get(e){let t=en(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof iS?t:null}hasIndex(e){return ei(this.indexSet_,e.toString())}addIndex(e,t){let i;T(e!==ib,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],r=!1,s=t.getIterator(ig.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=s.getNext();i=r?iA(n,e.getCompare()):iM;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let h=Object.assign({},this.indexes_);return h[a]=i,new iL(h,l)}addToIndexes(e,t){return new iL(es(this.indexes_,(i,n)=>{let r=en(this.indexSet_,n);if(T(r,"Missing index implementation for "+n),i===iM){if(!r.isDefinedOn(e.node))return iM;{let i=[],n=t.getIterator(ig.Wrap),s=n.getNext();for(;s;)s.name!==e.name&&i.push(s),s=n.getNext();return i.push(e),iA(i,r.getCompare())}}{let n=t.get(e.name),r=i;return n&&(r=r.remove(new ig(e.name,n))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new iL(es(this.indexes_,i=>{if(i===iM)return i;{let n=t.get(e.name);return n?i.remove(new ig(e.name,n)):i}}),this.indexSet_)}}class iF{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&ik(this.priorityNode_),this.children_.isEmpty()&&T(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return u||(u=new iF(new iS(ix),null,iL.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||u}updatePriority(e){return this.children_.isEmpty()?this:new iF(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?u:t}}getChild(e){let t=t9(e);return null===t?this:this.getImmediateChild(t).getChild(ie(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(T(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let i,n;let r=new ig(e,t);t.isEmpty()?(i=this.children_.remove(e),n=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,t),n=this.indexMap_.addToIndexes(r,this.children_));let s=i.isEmpty()?u:this.priorityNode_;return new iF(i,s,n)}}updateChild(e,t){let i=t9(e);if(null===i)return t;{T(".priority"!==t9(e)||1===t7(e),".priority must be the last token in a path");let n=this.getImmediateChild(i).updateChild(ie(e),t);return this.updateImmediateChild(i,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},i=0,n=0,r=!0;if(this.forEachChild(iO,(s,o)=>{t[s]=o.val(e),i++,r&&iF.INTEGER_REGEXP_.test(s)?n=Math.max(n,Number(s)):r=!1}),e||!r||!(n<2*i))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let i in t)e[i]=t[i];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+iT(this.getPriority().val())+":"),this.forEachChild(iO,(t,i)=>{let n=i.hash();""!==n&&(e+=":"+t+":"+n)}),this.lazyHash_=""===e?"":tu(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){let n=this.resolveIndex_(i);if(!n)return this.children_.getPredecessorKey(e);{let i=n.getPredecessorKey(new ig(e,t));return i?i.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new ig(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new ig(t,this.children_.get(t)):null}forEachChild(e,t){let i=this.resolveIndex_(e);return i?i.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,e=>e);{let i=this.children_.getIteratorFrom(e.name,ig.Wrap),n=i.peek();for(;null!=n&&0>t.compare(n,e);)i.getNext(),n=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,e=>e);{let i=this.children_.getReverseIteratorFrom(e.name,ig.Wrap),n=i.peek();for(;null!=n&&t.compare(n,e)>0;)i.getNext(),n=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===iU?-1:0}withIndex(e){if(e===ib||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new iF(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ib||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(iO),i=e.getIterator(iO),n=t.getNext(),r=i.getNext();for(;n&&r;){if(n.name!==r.name||!n.node.equals(r.node))return!1;n=t.getNext(),r=i.getNext()}return null===n&&null===r}}resolveIndex_(e){return e===ib?null:this.indexMap_.get(e.toString())}}iF.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class iq extends iF{constructor(){super(new iS(ix),iF.EMPTY_NODE,iL.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return iF.EMPTY_NODE}isEmpty(){return!1}}let iU=new iq;function ij(e,t=null){if(null===e)return iF.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),T(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new iN(e,ij(t));if(e instanceof Array){let i=iF.EMPTY_NODE;return tO(e,(t,n)=>{if(ei(e,t)&&"."!==t.substring(0,1)){let e=ij(n);(e.isLeafNode()||!e.isEmpty())&&(i=i.updateImmediateChild(t,e))}}),i.updatePriority(ij(t))}{let i=[],n=!1;if(tO(e,(e,t)=>{if("."!==e.substring(0,1)){let r=ij(t);r.isEmpty()||(n=n||!r.getPriority().isEmpty(),i.push(new ig(e,r)))}}),0===i.length)return iF.EMPTY_NODE;let r=iA(i,iI,e=>e.name,ix);if(!n)return new iF(r,ij(t),iL.Default);{let e=iA(i,iO.getCompare());return new iF(r,ij(t),new iL({".priority":e},{".priority":iO}))}}}Object.defineProperties(ig,{MIN:{value:new ig(tS,iF.EMPTY_NODE)},MAX:{value:new ig(tI,iU)}}),iv.__EMPTY_NODE=iF.EMPTY_NODE,iN.__childrenNodeConstructor=iF,o=iU,h=iU,l=ij;class iB extends iy{constructor(e){super(),this.indexPath_=e,T(!io(e)&&".priority"!==t9(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),n=this.extractChild(t.node),r=i.compareTo(n);return 0===r?tx(e.name,t.name):r}makePost(e,t){let i=ij(e);return new ig(t,iF.EMPTY_NODE.updateChild(this.indexPath_,i))}maxPost(){return new ig(tI,iF.EMPTY_NODE.updateChild(this.indexPath_,iU))}toString(){return ii(this.indexPath_,0).join("/")}}class iH extends iy{compare(e,t){let i=e.node.compareTo(t.node);return 0===i?tx(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ig.MIN}maxPost(){return ig.MAX}makePost(e,t){return new ig(t,ij(e))}toString(){return".value"}}let iW=new iH;function iz(e){return{type:"value",snapshotNode:e}}function iV(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function i$(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function iK(e,t,i){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:i}}class iG{constructor(e){this.index_=e}updateChild(e,t,i,n,r,s){assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(n).equals(i.getChild(n))&&o.isEmpty()===i.isEmpty()?e:(null!=s&&(i.isEmpty()?e.hasChild(t)?s.trackChildChange(i$(t,o)):assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(iV(t,i)):s.trackChildChange(iK(t,i,o))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null==i||(e.isLeafNode()||e.forEachChild(iO,(e,n)=>{t.hasChild(e)||i.trackChildChange(i$(e,n))}),t.isLeafNode()||t.forEachChild(iO,(t,n)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(n)||i.trackChildChange(iK(t,n,r))}else i.trackChildChange(iV(t,n))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?iF.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class iY{constructor(e){this.indexedFilter_=new iG(e.getIndex()),this.index_=e.getIndex(),this.startPost_=iY.getStartPost_(e),this.endPost_=iY.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),i=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&i}updateChild(e,t,i,n,r,s){return this.matches(new ig(t,i))||(i=iF.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,n,r,s)}updateFullNode(e,t,i){t.isLeafNode()&&(t=iF.EMPTY_NODE);let n=t.withIndex(this.index_);n=n.updatePriority(iF.EMPTY_NODE);let r=this;return t.forEachChild(iO,(e,t)=>{r.matches(new ig(e,t))||(n=n.updateImmediateChild(e,iF.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,n,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class iQ{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new iY(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,n,r,s){return(this.rangedFilter_.matches(new ig(t,i))||(i=iF.EMPTY_NODE),e.getImmediateChild(t).equals(i))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,n,r,s):this.fullLimitUpdateChild_(e,t,i,r,s)}updateFullNode(e,t,i){let n;if(t.isLeafNode()||t.isEmpty())n=iF.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;n=iF.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let i=0;for(;e.hasNext()&&i<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t)){if(this.withinDirectionalEnd(t))n=n.updateImmediateChild(t.name,t.node),i++;else break}}}else{let e;n=(n=t.withIndex(this.index_)).updatePriority(iF.EMPTY_NODE),e=this.reverse_?n.getReverseIterator(this.index_):n.getIterator(this.index_);let i=0;for(;e.hasNext();){let t=e.getNext();i<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?i++:n=n.updateImmediateChild(t.name,iF.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,n,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,i)=>e(i,t)}else s=this.index_.getCompare();assert(e.numChildren()===this.limit_,"");let o=new ig(t,i),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),c=n.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=c&&(c.name===t||e.hasChild(c.name));)c=n.getChildAfterChild(this.index_,c,this.reverse_);let u=null==c?1:s(c,o);if(l&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(iK(t,i,h)),e.updateImmediateChild(t,i);{null!=r&&r.trackChildChange(i$(t,h));let i=e.updateImmediateChild(t,iF.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(iV(c.name,c.node)),i.updateImmediateChild(c.name,c.node)):i}}return i.isEmpty()?e:l&&s(a,o)>=0?(null!=r&&(r.trackChildChange(i$(a.name,a.node)),r.trackChildChange(iV(t,i))),e.updateImmediateChild(t,i).updateImmediateChild(a.name,iF.EMPTY_NODE)):e}}class iJ{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=iO}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return T(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(T(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:tS}hasEnd(){return this.endSet_}getIndexEndValue(){return T(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(T(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:tI}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return T(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===iO}copy(){let e=new iJ;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function iZ(e){let t;let i={};if(e.isDefault())return i;if(e.index_===iO?t="$priority":e.index_===iW?t="$value":e.index_===ib?t="$key":(T(e.index_ instanceof iB,"Unrecognized index type!"),t=e.index_.toString()),i.orderBy=Z(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";i[t]=Z(e.indexStartValue_),e.startNameSet_&&(i[t]+=","+Z(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";i[t]=Z(e.indexEndValue_),e.endNameSet_&&(i[t]+=","+Z(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?i.limitToFirst=e.limit_:i.limitToLast=e.limit_),i}function iX(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let i=e.viewFrom_;""===i&&(i=e.isViewFromLeft()?"l":"r"),t.vf=i}return e.index_!==iO&&(t.i=e.index_.toString()),t}class i0 extends t3{constructor(e,t,i,n){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=n,this.log_=tg("p:rest:"),this.listens_={}}reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(T(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,n){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=i0.getListenId_(e,i),o={};this.listens_[s]=o;let a=iZ(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,i),en(this.listens_,s)===o&&n(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let i=i0.getListenId_(e,t);delete this.listens_[i]}get(e){let t=iZ(e._queryParams),i=e._path.toString(),n=new W;return this.restRequest_(i+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(i,r,!1,null),n.resolve(r)):n.reject(Error(r))}),n.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([n,r])=>{n&&n.accessToken&&(t.auth=n.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){let t=[];for(let[i,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(i&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=J(o.responseText)}catch(e){tb("Failed to parse JSON response for "+s+": "+o.responseText)}i(null,e)}else 401!==o.status&&404!==o.status&&tb("Got unsuccessful REST response for "+s+" Status: "+o.status),i(o.status);i=null}},o.open("GET",s,!0),o.send()})}}class i1{constructor(){this.rootNode_=iF.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function i2(){return{value:null,children:new Map}}function i3(e,t,i){if(io(t))e.value=i,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,i);else{let n=t9(t);e.children.has(n)||e.children.set(n,i2()),i3(e.children.get(n),t=ie(t),i)}}function i4(e,t,i){null!==e.value?i(t,e.value):function(e,t){e.children.forEach((e,i)=>{t(i,e)})}(e,(e,n)=>{i4(n,new t8(t.toString()+"/"+e),i)})}class i6{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&tO(this.last_,(e,i)=>{t[e]=t[e]-i}),this.last_=e,t}}class i8{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new i6(e),tL(this.reportStats_.bind(this),Math.floor(1e4+2e4*Math.random()))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;tO(e,(e,n)=>{n>0&&ei(this.statsToReport_,e)&&(t[e]=n,i=!0)}),i&&this.server_.reportStats(t),tL(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function i5(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function i9(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function i7(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(C||(C={}));class ne{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=C.ACK_USER_WRITE,this.source=i5()}operationForChild(e){if(!io(this.path))return T(t9(this.path)===e,"operationForChild called for unrelated child."),new ne(ie(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return T(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new t8(e));return new ne(t5(),t,this.revert)}}}class nt{constructor(e,t){this.source=e,this.path=t,this.type=C.LISTEN_COMPLETE}operationForChild(e){return io(this.path)?new nt(this.source,t5()):new nt(this.source,ie(this.path))}}class ni{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=C.OVERWRITE}operationForChild(e){return io(this.path)?new ni(this.source,t5(),this.snap.getImmediateChild(e)):new ni(this.source,ie(this.path),this.snap)}}class nn{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=C.MERGE}operationForChild(e){if(!io(this.path))return T(t9(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new nn(this.source,ie(this.path),this.children);{let t=this.children.subtree(new t8(e));return t.isEmpty()?null:t.value?new ni(this.source,t5(),t.value):new nn(this.source,t5(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class nr{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(io(e))return this.isFullyInitialized()&&!this.filtered_;let t=t9(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class ns{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function no(e,t,i,n,r,s){let o=n.filter(e=>e.type===i);o.sort((t,i)=>(function(e,t,i){if(null==t.childName||null==i.childName)throw k("Should only compare child_ events.");let n=new ig(t.childName,t.snapshotNode),r=new ig(i.childName,i.snapshotNode);return e.index_.compare(n,r)})(e,t,i)),o.forEach(i=>{let n=("value"===i.type||"child_removed"===i.type||(i.prevName=s.getPredecessorChildName(i.childName,i.snapshotNode,e.index_)),i);r.forEach(r=>{r.respondsTo(i.type)&&t.push(r.createEvent(n,e.query_))})})}function na(e,t){return{eventCache:e,serverCache:t}}function nl(e,t,i,n){return na(new nr(t,i,n),e.serverCache)}function nh(e,t,i,n){return na(e.eventCache,new nr(t,i,n))}function nc(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nu(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let nd=()=>(d||(d=new iS(tT)),d);class np{constructor(e,t=nd()){this.value=e,this.children=t}static fromObject(e){let t=new np(null);return tO(e,(e,i)=>{t=t.set(new t8(e),i)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:t5(),value:this.value};if(io(e))return null;{let i=t9(e),n=this.children.get(i);if(null===n)return null;{let r=n.findRootMostMatchingPathAndValue(ie(e),t);return null!=r?{path:is(new t8(i),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(io(e))return this;{let t=t9(e),i=this.children.get(t);return null!==i?i.subtree(ie(e)):new np(null)}}set(e,t){if(io(e))return new np(t,this.children);{let i=t9(e),n=(this.children.get(i)||new np(null)).set(ie(e),t),r=this.children.insert(i,n);return new np(this.value,r)}}remove(e){if(io(e))return this.children.isEmpty()?new np(null):new np(null,this.children);{let t=t9(e),i=this.children.get(t);if(!i)return this;{let n;let r=i.remove(ie(e));return(n=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&n.isEmpty())?new np(null):new np(this.value,n)}}}get(e){if(io(e))return this.value;{let t=t9(e),i=this.children.get(t);return i?i.get(ie(e)):null}}setTree(e,t){if(io(e))return t;{let i;let n=t9(e),r=(this.children.get(n)||new np(null)).setTree(ie(e),t);return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new np(this.value,i)}}fold(e){return this.fold_(t5(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((n,r)=>{i[n]=r.fold_(is(e,n),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,t5(),t)}findOnPath_(e,t,i){let n=!!this.value&&i(t,this.value);if(n)return n;if(io(e))return null;{let n=t9(e),r=this.children.get(n);return r?r.findOnPath_(ie(e),is(t,n),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,t5(),t)}foreachOnPath_(e,t,i){if(io(e))return this;{this.value&&i(t,this.value);let n=t9(e),r=this.children.get(n);return r?r.foreachOnPath_(ie(e),is(t,n),i):new np(null)}}foreach(e){this.foreach_(t5(),e)}foreach_(e,t){this.children.inorderTraversal((i,n)=>{n.foreach_(is(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class nf{constructor(e){this.writeTree_=e}static empty(){return new nf(new np(null))}}function n_(e,t,i){if(io(t))return new nf(new np(i));{let n=e.writeTree_.findRootMostValueAndPath(t);if(null!=n){let r=n.path,s=n.value,o=ia(r,t);return s=s.updateChild(o,i),new nf(e.writeTree_.set(r,s))}{let n=new np(i);return new nf(e.writeTree_.setTree(t,n))}}}function nm(e,t,i){let n=e;return tO(i,(e,i)=>{n=n_(n,is(t,e),i)}),n}function ng(e,t){return io(t)?nf.empty():new nf(e.writeTree_.setTree(t,new np(null)))}function ny(e,t){return null!=nv(e,t)}function nv(e,t){let i=e.writeTree_.findRootMostValueAndPath(t);return null!=i?e.writeTree_.get(i.path).getChild(ia(i.path,t)):null}function nb(e){let t=[],i=e.writeTree_.value;return null!=i?i.isLeafNode()||i.forEachChild(iO,(e,i)=>{t.push(new ig(e,i))}):e.writeTree_.children.inorderTraversal((e,i)=>{null!=i.value&&t.push(new ig(e,i.value))}),t}function nw(e,t){if(io(t))return e;{let i=nv(e,t);return new nf(null!=i?new np(i):e.writeTree_.subtree(t))}}function nC(e){return e.writeTree_.isEmpty()}function nE(e,t){return function e(t,i,n){if(null!=i.value)return n.updateChild(t,i.value);{let r=null;return i.children.inorderTraversal((i,s)=>{".priority"===i?(T(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):n=e(is(t,i),s,n)}),n.getChild(t).isEmpty()||null===r||(n=n.updateChild(is(t,".priority"),r)),n}}(t5(),e.writeTree_,t)}function nS(e){return e.visible}function nI(e,t,i){let n=nf.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e;let t=s.path;if(s.snap)ic(i,t)?n=n_(n,e=ia(i,t),s.snap):ic(t,i)&&(e=ia(t,i),n=n_(n,t5(),s.snap.getChild(e)));else if(s.children){if(ic(i,t))n=nm(n,e=ia(i,t),s.children);else if(ic(t,i)){if(io(e=ia(t,i)))n=nm(n,t5(),s.children);else{let t=en(s.children,t9(e));if(t){let i=t.getChild(ie(e));n=n_(n,t5(),i)}}}}else throw k("WriteRecord should have .snap or .children")}}return n}function nx(e,t,i,n,r){if(n||r){let s=nw(e.visibleWrites,t);return!r&&nC(s)?i:r||null!=i||ny(s,t5())?nE(nI(e.allWrites,function(e){return(e.visible||r)&&(!n||!~n.indexOf(e.writeId))&&(ic(e.path,t)||ic(t,e.path))},t),i||iF.EMPTY_NODE):null}{let n=nv(e.visibleWrites,t);if(null!=n)return n;{let n=nw(e.visibleWrites,t);return nC(n)?i:null!=i||ny(n,t5())?nE(n,i||iF.EMPTY_NODE):null}}}function nT(e,t,i,n){return nx(e.writeTree,e.treePath,t,i,n)}function nk(e,t){return function(e,t,i){let n=iF.EMPTY_NODE,r=nv(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(iO,(e,t)=>{n=n.updateImmediateChild(e,t)}),n;if(!i)return nb(nw(e.visibleWrites,t)).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n;{let r=nw(e.visibleWrites,t);return i.forEachChild(iO,(e,t)=>{let i=nE(nw(r,new t8(e)),t);n=n.updateImmediateChild(e,i)}),nb(r).forEach(e=>{n=n.updateImmediateChild(e.name,e.node)}),n}}(e.writeTree,e.treePath,t)}function nN(e,t,i,n){return function(e,t,i,n,r){T(n||r,"Either existingEventSnap or existingServerSnap must exist");let s=is(t,i);if(ny(e.visibleWrites,s))return null;{let t=nw(e.visibleWrites,s);return nC(t)?r.getChild(i):nE(t,r.getChild(i))}}(e.writeTree,e.treePath,t,i,n)}function nP(e,t){var i,n;return i=e.writeTree,n=is(e.treePath,t),nv(i.visibleWrites,n)}function nO(e,t,i){return function(e,t,i,n){let r=is(t,i),s=nv(e.visibleWrites,r);return null!=s?s:n.isCompleteForChild(i)?nE(nw(e.visibleWrites,r),n.getNode().getImmediateChild(i)):null}(e.writeTree,e.treePath,t,i)}function nR(e,t){return nD(is(e.treePath,t),e.writeTree)}function nD(e,t){return{treePath:e,writeTree:t}}class nA{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;T("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),T(".priority"!==i,"Only non-priority child changes can be tracked.");let n=this.changeMap.get(i);if(n){let r=n.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(i,iK(i,e.snapshotNode,n.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(i,i$(i,n.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(i,iV(i,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(i,iK(i,e.snapshotNode,n.oldSnap));else throw k("Illegal combination of changes: "+e+" occurred after "+n)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class nM{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}let nL=new nM;class nF{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new nr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return nO(this.writes_,e,t)}}getChildAfterChild(e,t,i){var n;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nu(this.viewCache_),s=function(e,t,i,n,r,s,o){let a;let l=nw(e.visibleWrites,t),h=nv(l,t5());if(null!=h)a=h;else{if(null==i)return[];a=nE(l,i)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),i=s?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),r=i.getNext();for(;r&&e.length<1;)0!==t(r,n)&&e.push(r),r=i.getNext();return e}}((n=this.writes_).writeTree,n.treePath,r,t,0,i,e);return 0===s.length?null:s[0]}}function nq(e,t,i,n,r,s){let o=t.eventCache;if(null!=nP(n,i))return t;{let a,l;if(io(i)){if(T(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let i=nu(t),r=nk(n,i instanceof iF?i:iF.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let i=nT(n,nu(t));a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}}else{let h=t9(i);if(".priority"===h){T(1===t7(i),"Can't have a priority with additional path components");let r=o.getNode(),s=nN(n,i,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let c;let u=ie(i);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=nN(n,i,o.getNode(),l);c=null!=e?o.getNode().getImmediateChild(h).updateChild(u,e):o.getNode().getImmediateChild(h)}else c=nO(n,h,t.serverCache);a=null!=c?e.filter.updateChild(o.getNode(),h,c,u,r,s):o.getNode()}}return nl(t,a,o.isFullyInitialized()||io(i),e.filter.filtersNodes())}}function nU(e,t,i,n,r,s,o,a){let l;let h=t.serverCache,c=o?e.filter:e.filter.getIndexedFilter();if(io(i))l=c.updateFullNode(h.getNode(),n,null);else if(c.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(i,n);l=c.updateFullNode(h.getNode(),e,null)}else{let e=t9(i);if(!h.isCompleteForPath(i)&&t7(i)>1)return t;let r=ie(i),s=h.getNode().getImmediateChild(e).updateChild(r,n);l=".priority"===e?c.updatePriority(h.getNode(),s):c.updateChild(h.getNode(),e,s,r,nL,null)}let u=nh(t,l,h.isFullyInitialized()||io(i),c.filtersNodes()),d=new nF(r,u,s);return nq(e,u,i,r,d,a)}function nj(e,t,i,n,r,s,o){let a,l;let h=t.eventCache,c=new nF(r,t,s);if(io(i))l=e.filter.updateFullNode(t.eventCache.getNode(),n,o),a=nl(t,l,!0,e.filter.filtersNodes());else{let r=t9(i);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),n),a=nl(t,l,h.isFullyInitialized(),h.isFiltered());else{let s;let l=ie(i),u=h.getNode().getImmediateChild(r);if(io(l))s=n;else{let e=c.getCompleteChild(r);s=null!=e?".priority"===it(l)&&e.getChild(ir(l)).isEmpty()?e:e.updateChild(l,n):iF.EMPTY_NODE}a=u.equals(s)?t:nl(t,e.filter.updateChild(h.getNode(),r,s,l,c,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function nB(e,t){return e.eventCache.isCompleteForChild(t)}function nH(e,t,i){return i.foreach((e,i)=>{t=t.updateChild(e,i)}),t}function nW(e,t,i,n,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=io(i)?n:new np(null).setTree(i,n);let c=t.serverCache.getNode();return l.children.inorderTraversal((i,n)=>{if(c.hasChild(i)){let l=nH(e,t.serverCache.getNode().getImmediateChild(i),n);h=nU(e,h,new t8(i),l,r,s,o,a)}}),l.children.inorderTraversal((i,n)=>{let l=!t.serverCache.isCompleteForChild(i)&&null===n.value;if(!c.hasChild(i)&&!l){let l=nH(e,t.serverCache.getNode().getImmediateChild(i),n);h=nU(e,h,new t8(i),l,r,s,o,a)}}),h}class nz{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,n=new iG(i.getIndex()),r=function(e){return e.loadsAllData()?new iG(e.getIndex()):e.hasLimit()?new iQ(e):new iY(e)}(i);this.processor_={filter:r};let s=t.serverCache,o=t.eventCache,a=n.updateFullNode(iF.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(iF.EMPTY_NODE,o.getNode(),null),h=new nr(a,s.isFullyInitialized(),n.filtersNodes()),c=new nr(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=na(c,h),this.eventGenerator_=new ns(this.query_)}get query(){return this.query_}}function nV(e){return 0===e.eventRegistrations_.length}function n$(e,t,i){let n=[];if(i){assert(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(i,r);t&&n.push(t)})}if(t){let i=[];for(let n=0;n<e.eventRegistrations_.length;++n){let r=e.eventRegistrations_[n];if(r.matches(t)){if(t.hasAnyCallback()){i=i.concat(e.eventRegistrations_.slice(n+1));break}}else i.push(r)}e.eventRegistrations_=i}else e.eventRegistrations_=[];return n}function nK(e,t,i,n){var r,s;t.type===C.MERGE&&null!==t.source.queryId&&(T(nu(e.viewCache_),"We should always have a full cache before handling merges"),T(nc(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,i,n,r){let s,o;let a=new nA;if(i.type===C.OVERWRITE)i.source.fromUser?s=nj(e,t,i.path,i.snap,n,r,a):(T(i.source.fromServer,"Unknown source."),o=i.source.tagged||t.serverCache.isFiltered()&&!io(i.path),s=nU(e,t,i.path,i.snap,n,r,o,a));else if(i.type===C.MERGE){var l,h;let c;i.source.fromUser?(l=i.path,h=i.children,c=t,h.foreach((i,s)=>{let o=is(l,i);nB(t,t9(o))&&(c=nj(e,c,o,s,n,r,a))}),h.foreach((i,s)=>{let o=is(l,i);nB(t,t9(o))||(c=nj(e,c,o,s,n,r,a))}),s=c):(T(i.source.fromServer,"Unknown source."),o=i.source.tagged||t.serverCache.isFiltered(),s=nW(e,t,i.path,i.children,n,r,o,a))}else if(i.type===C.ACK_USER_WRITE)s=i.revert?function(e,t,i,n,r,s){let o;if(null!=nP(n,i))return t;{let a;let l=new nF(n,t,r),h=t.eventCache.getNode();if(io(i)||".priority"===t9(i)){let i;if(t.serverCache.isFullyInitialized())i=nT(n,nu(t));else{let e=t.serverCache.getNode();T(e instanceof iF,"serverChildren would be complete if leaf node"),i=nk(n,e)}a=e.filter.updateFullNode(h,i,s)}else{let r=t9(i),c=nO(n,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),(a=null!=c?e.filter.updateChild(h,r,c,ie(i),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,iF.EMPTY_NODE,ie(i),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=nT(n,nu(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=nP(n,t5()),nl(t,a,o,e.filter.filtersNodes())}}(e,t,i.path,n,r,a):function(e,t,i,n,r,s,o){if(null!=nP(r,i))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(io(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return nU(e,t,i,l.getNode().getChild(i),r,s,a,o);if(!io(i))return t;{let n=new np(null);return l.getNode().forEachChild(ib,(e,t)=>{n=n.set(new t8(e),t)}),nW(e,t,i,n,r,s,a,o)}}{let h=new np(null);return n.foreach((e,t)=>{let n=is(i,e);l.isCompleteForPath(n)&&(h=h.set(e,l.getNode().getChild(n)))}),nW(e,t,i,h,r,s,a,o)}}(e,t,i.path,i.affectedTree,n,r,a);else if(i.type===C.LISTEN_COMPLETE)s=function(e,t,i,n,r){let s=t.serverCache;return nq(e,nh(t,s.getNode(),s.isFullyInitialized()||io(i),s.isFiltered()),i,n,nL,r)}(e,t,i.path,n,a);else throw k("Unknown operation type: "+i.type);let c=a.getChanges();return function(e,t,i){let n=t.eventCache;if(n.isFullyInitialized()){let r=n.getNode().isLeafNode()||n.getNode().isEmpty(),s=nc(e);!(i.length>0)&&e.eventCache.isFullyInitialized()&&(!r||n.getNode().equals(s))&&n.getNode().getPriority().equals(s.getPriority())||i.push(iz(nc(t)))}}(t,s,c),{viewCache:s,changes:c}}(e.processor_,o,t,i,n);return r=e.processor_,T((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),T(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),T(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,nG(e,a.changes,a.viewCache.eventCache.getNode(),null)}function nG(e,t,i,n){let r=n?[n]:e.eventRegistrations_;return function(e,t,i,n){let r=[],s=[];return t.forEach(t=>{if("child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)){var i;s.push((i=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:i}))}}),no(e,r,"child_removed",t,n,i),no(e,r,"child_added",t,n,i),no(e,r,"child_moved",s,n,i),no(e,r,"child_changed",t,n,i),no(e,r,"value",t,n,i),r}(e.eventGenerator_,t,i,r)}class nY{constructor(){this.views=new Map}}function nQ(e,t,i,n){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return T(null!=s,"SyncTree gave us an op for an invalid query."),nK(s,t,i,n)}{let r=[];for(let s of e.views.values())r=r.concat(nK(s,t,i,n));return r}}function nJ(e){let t=[];for(let i of e.views.values())i.query._queryParams.loadsAllData()||t.push(i);return t}function nZ(e,t){let i=null;for(let n of e.views.values())i=i||function(e,t){let i=nu(e.viewCache_);return i&&(e.query._queryParams.loadsAllData()||!io(t)&&!i.getImmediateChild(t9(t)).isEmpty())?i.getChild(t):null}(n,t);return i}function nX(e,t){if(t._queryParams.loadsAllData())return n1(e);{let i=t._queryIdentifier;return e.views.get(i)}}function n0(e){return null!=n1(e)}function n1(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let n2=1;class n3{constructor(e){this.listenProvider_=e,this.syncPointTree_=new np(null),this.pendingWriteTree_={visibleWrites:nf.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function n4(e,t,i,n,r){var s,o;return(s=e.pendingWriteTree_,o=r,T(n>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:i,writeId:n,visible:o}),o&&(s.visibleWrites=n_(s.visibleWrites,t,i)),s.lastWriteId=n,r)?n7(e,new ni(i5(),t,i)):[]}function n6(e,t,i=!1){let n=function(e,t){for(let i=0;i<e.allWrites.length;i++){let n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(!function(e,t){let i=e.allWrites.findIndex(e=>e.writeId===t);T(i>=0,"removeWrite called with nonexistent writeId.");let n=e.allWrites[i];e.allWrites.splice(i,1);let r=n.visible,s=!1,o=e.allWrites.length-1;for(;r&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=i&&function(e,t){if(e.snap)return ic(e.path,t);for(let i in e.children)if(e.children.hasOwnProperty(i)&&ic(is(e.path,i),t))return!0;return!1}(t,n.path)?r=!1:ic(n.path,t.path)&&(s=!0)),o--}return!!r&&(s?(e.visibleWrites=nI(e.allWrites,nS,t5()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):n.snap?e.visibleWrites=ng(e.visibleWrites,n.path):tO(n.children,t=>{e.visibleWrites=ng(e.visibleWrites,is(n.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new np(null);return null!=n.snap?t=t.set(t5(),!0):tO(n.children,e=>{t=t.set(new t8(e),!0)}),n7(e,new ne(n.path,t,i))}}function n8(e,t,i){return n7(e,new ni(i9(),t,i))}function n5(e,t,i,n,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=nX(o,t))){let l=function(e,t,i,n){let r=t._queryIdentifier,s=[],o=[],a=n0(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(n$(r,i,n)),nV(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(n$(t,i,n)),nV(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!n0(e)&&s.push(new(assert(p,"Reference.ts has not been loaded"),p)(t._repo,t._path)),{removed:s,events:o}}(o,t,i,n);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let h=l.removed;if(a=l.events,!r){let i=-1!==h.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>n0(t));if(i&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let i=t.fold((e,t,i)=>{if(t&&n0(t))return[n1(t)];{let e=[];return t&&(e=nJ(t)),tO(i,(t,i)=>{e=e.concat(i)}),e}});for(let t=0;t<i.length;++t){let n=i[t],r=n.query,s=re(e,n);e.listenProvider_.startListening(ro(r),rt(e,r),s.hashFn,s.onComplete)}}}r||!(h.length>0)||n||(i?e.listenProvider_.stopListening(ro(t),null):h.forEach(t=>{let i=e.queryToTagMap.get(ri(t));e.listenProvider_.stopListening(ro(t),i)}))}(function(e,t){for(let i=0;i<t.length;++i){let n=t[i];if(!n._queryParams.loadsAllData()){let t=ri(n),i=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(i)}}})(e,h)}return a}function n9(e,t,i){let n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,i)=>{let n=nZ(i,ia(e,t));if(n)return n});return nx(n,t,r,i,!0)}function n7(e,t){var i;return function e(t,i,n,r){if(io(t.path))return function e(t,i,n,r){let s=i.get(t5());null==n&&null!=s&&(n=nZ(s,t5()));let o=[];return i.children.inorderTraversal((i,s)=>{let a=n?n.getImmediateChild(i):null,l=nR(r,i),h=t.operationForChild(i);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(nQ(s,t,r,n))),o}(t,i,n,r);{let s=i.get(t5());null==n&&null!=s&&(n=nZ(s,t5()));let o=[],a=t9(t.path),l=t.operationForChild(a),h=i.children.get(a);if(h&&l){let t=n?n.getImmediateChild(a):null,i=nR(r,a);o=o.concat(e(l,h,t,i))}return s&&(o=o.concat(nQ(s,t,r,n))),o}}(t,e.syncPointTree_,null,(i=e.pendingWriteTree_,nD(t5(),i)))}function re(e,t){let i=t.query,n=rt(e,i);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||iF.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t){var r;return n?function(e,t,i){let n=rn(e,i);if(!n)return[];{let i=rr(n),r=i.path,s=i.queryId,o=ia(r,t);return rs(e,r,new nt(i7(s),o))}}(e,i._path,n):(r=i._path,n7(e,new nt(i9(),r)))}{let n=function(e,t){let i="Unknown Error";"too_big"===e?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?i="Client doesn't have permission to access the desired data.":"unavailable"===e&&(i="The service is unavailable");let n=Error(e+" at "+t._path.toString()+": "+i);return n.code=e.toUpperCase(),n}(t,i);return n5(e,i,null,n)}}}}function rt(e,t){let i=ri(t);return e.queryToTagMap.get(i)}function ri(e){return e._path.toString()+"$"+e._queryIdentifier}function rn(e,t){return e.tagToQueryMap.get(t)}function rr(e){let t=e.indexOf("$");return T(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new t8(e.substr(0,t))}}function rs(e,t,i){let n=e.syncPointTree_.get(t);return T(n,"Missing sync point for query tag that we're tracking"),nQ(n,i,nD(t,e.pendingWriteTree_),null)}function ro(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(assert(f,"Reference.ts has not been loaded"),f)(e._repo,e._path):e}class ra{constructor(e){this.node_=e}getImmediateChild(e){return new ra(this.node_.getImmediateChild(e))}node(){return this.node_}}class rl{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=is(this.path_,e);return new rl(this.syncTree_,t)}node(){return n9(this.syncTree_,this.path_)}}let rh=function(e,t,i){return e&&"object"==typeof e?(T(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?rc(e[".sv"],t,i):"object"==typeof e[".sv"]?ru(e[".sv"],t):void T(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},rc=function(e,t,i){if("timestamp"===e)return i.timestamp;T(!1,"Unexpected server value: "+e)},ru=function(e,t,i){e.hasOwnProperty("increment")||T(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let n=e.increment;"number"!=typeof n&&T(!1,"Unexpected increment value: "+n);let r=t.node();if(T(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;let s=r.getValue();return"number"!=typeof s?n:s+n},rd=function(e,t,i){return rp(e,new ra(t),i)};function rp(e,t,i){let n;let r=rh(e.getPriority().val(),t.getImmediateChild(".priority"),i);if(!e.isLeafNode())return n=e,r!==e.getPriority().val()&&(n=n.updatePriority(new iN(r))),e.forEachChild(iO,(e,r)=>{let s=rp(r,t.getImmediateChild(e),i);s!==r&&(n=n.updateImmediateChild(e,s))}),n;{let n=rh(e.getValue(),t,i);return n!==e.getValue()||r!==e.getPriority().val()?new iN(n,ij(r)):e}}class rf{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function r_(e,t){let i=t instanceof t8?t:new t8(t),n=e,r=t9(i);for(;null!==r;){let e=en(n.node.children,r)||{children:{},childCount:0};n=new rf(r,n,e),r=t9(i=ie(i))}return n}function rm(e){return e.node.value}function rg(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,i,n){let r=void 0===rm(n)&&!ry(n),s=ei(t.node.children,i);r&&s?(delete t.node.children[i],t.node.childCount--,e(t)):r||s||(t.node.children[i]=n.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function ry(e){return e.node.childCount>0}function rv(e,t){tO(e.node.children,(i,n)=>{t(new rf(i,e,n))})}function rb(e){return new t8(null===e.parent?e.name:rb(e.parent)+"/"+e.name)}let rw=/[\[\].#$\/\u0000-\u001F\u007F]/,rC=/[\[\].#$\u0000-\u001F\u007F]/,rE=function(e){return"string"==typeof e&&0!==e.length&&!rw.test(e)},rS=function(e){return"string"==typeof e&&0!==e.length&&!rC.test(e)},rI=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!tC(e)||e&&"object"==typeof e&&ei(e,".sv")},rx=function(e,t,i,n){n&&void 0===t||rT(eh(e,"value"),t,i)},rT=function(e,t,i){let n=i instanceof t8?new iu(i,e):i;if(void 0===t)throw Error(e+"contains undefined "+ip(n));if("function"==typeof t)throw Error(e+"contains a function "+ip(n)+" with contents = "+t.toString());if(tC(t))throw Error(e+"contains "+t.toString()+" "+ip(n));if("string"==typeof t&&t.length>3495253.3333333335&&eu(t)>10485760)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+ip(n)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let i=!1,r=!1;if(tO(t,(t,s)=>{if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!rE(t)))throw Error(e+" contains an invalid key ("+t+") "+ip(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=eu(t),id(n),rT(e,s,n),function(e){let t=e.parts_.pop();e.byteLength_-=eu(t),e.parts_.length>0&&(e.byteLength_-=1)}(n)}),i&&r)throw Error(e+' contains ".value" child '+ip(n)+" in addition to actual children.")}},rk=function(e,t){let i,n;for(i=0;i<t.length;i++){let r=ii(n=t[i]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!rE(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(il);let r=null;for(i=0;i<t.length;i++){if(n=t[i],null!==r&&ic(r,n))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}},rN=function(e,t,i,n){if((!n||void 0!==i)&&!rS(i))throw Error(eh(e,t)+'was an invalid path = "'+i+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},rP=function(e,t,i,n){i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),rN(e,t,i,n)},rO=function(e,t){if(".info"===t9(t))throw Error(e+" failed = Can't modify data under /.info/")},rR=function(e,t){var i;let n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!rE(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&((i=n)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),!rS(i)))throw Error(eh(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class rD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rA(e,t){let i=null;for(let n=0;n<t.length;n++){let r=t[n],s=r.getPath();null===i||ih(s,i.path)||(e.eventLists_.push(i),i=null),null===i&&(i={events:[],path:s}),i.events.push(r)}i&&e.eventLists_.push(i)}function rM(e,t,i){rA(e,i),rL(e,e=>ic(e,t)||ic(t,e))}function rL(e,t){e.recursionDepth_++;let i=!0;for(let n=0;n<e.eventLists_.length;n++){let r=e.eventLists_[n];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let i=e.events[t];if(null!==i){e.events[t]=null;let n=i.getEventRunner();tp&&tm("event: "+i.toString()),tM(n)}}}(e.eventLists_[n]),e.eventLists_[n]=null):i=!1)}i&&(e.eventLists_=[]),e.recursionDepth_--}class rF{constructor(e,t,i,n){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=i2(),this.transactionQueueTree_=new rf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rq(e){var t;return(t=t={timestamp:function(e){let t=e.infoData_.getNode(new t8(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}(e)}).timestamp=t.timestamp||new Date().getTime(),t}function rU(e,t,i,n,r){e.dataUpdateCount++;let s=new t8(t);i=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,i):i;let o=[];if(r){if(n){let t=es(i,e=>ij(e));o=function(e,t,i,n){let r=rn(e,n);if(!r)return[];{let n=rr(r),s=n.path,o=n.queryId,a=ia(s,t),l=np.fromObject(i);return rs(e,s,new nn(i7(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=ij(i);o=function(e,t,i,n){let r=rn(e,n);if(null==r)return[];{let n=rr(r),s=n.path,o=n.queryId,a=ia(s,t);return rs(e,s,new ni(i7(o),a,i))}}(e.serverSyncTree_,s,t,r)}}else if(n){let t=es(i,e=>ij(e));o=function(e,t,i){let n=np.fromObject(i);return n7(e,new nn(i9(),t,n))}(e.serverSyncTree_,s,t)}else{let t=ij(i);o=n8(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=r$(e,s)),rM(e.eventQueue_,a,o)}function rj(e,t){rB(e,"connected",t),!1===t&&function(e){rW(e,"onDisconnectEvents");let t=rq(e),i=i2();i4(e.onDisconnect_,t5(),(n,r)=>{let s=rp(r,new rl(e.serverSyncTree_,n),t);i3(i,n,s)});let n=[];i4(i,t5(),(t,i)=>{n=n.concat(n8(e.serverSyncTree_,t,i));let r=rQ(e,t);r$(e,r)}),e.onDisconnect_=i2(),rM(e.eventQueue_,t5(),n)}(e)}function rB(e,t,i){let n=new t8("/.info/"+t),r=ij(i);e.infoData_.updateSnapshot(n,r);let s=n8(e.infoSyncTree_,n,r);rM(e.eventQueue_,n,s)}function rH(e){return e.nextWriteId_++}function rW(e,...t){let i="";e.persistentConnection_&&(i=e.persistentConnection_.id+":"),tm(i,...t)}function rz(e,t,i,n){t&&tM(()=>{if("ok"===i)t(null);else{let e=(i||"error").toUpperCase(),r=e;n&&(r+=": "+n);let s=Error(r);s.code=e,t(s)}})}function rV(e,t,i){return n9(e.serverSyncTree_,t,i)||iF.EMPTY_NODE}function r$(e,t){let i=rK(e,t),n=rb(i),r=rG(e,i);return function(e,t,i){if(0===t.length)return;let n=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=ia(i,a.path),h=!1,c;if(T(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,c=a.abortReason,r=r.concat(n6(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status){if(a.retryCount>=25)h=!0,c="maxretry",r=r.concat(n6(e.serverSyncTree_,a.currentWriteId,!0));else{let i=rV(e,a.path,s);a.currentInputSnapshot=i;let n=t[o].update(i.val());if(void 0!==n){rT("transaction failed: Data returned ",n,a.path);let t=ij(n);"object"==typeof n&&null!=n&&ei(n,".priority")||(t=t.updatePriority(i.getPriority()));let o=a.currentWriteId,l=rd(t,i,rq(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=rH(e),s.splice(s.indexOf(o),1),r=(r=r.concat(n4(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(n6(e.serverSyncTree_,o,!0))}else h=!0,c="nodata",r=r.concat(n6(e.serverSyncTree_,a.currentWriteId,!0))}}rM(e.eventQueue_,i,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===c?n.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):n.push(()=>t[o].onComplete(Error(c),!1,null))))}rY(e,e.transactionQueueTree_);for(let e=0;e<n.length;e++)tM(n[e]);(function e(t,i=t.transactionQueueTree_){if(i||rY(t,i),rm(i)){let n=rG(t,i);T(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(t,i,n){let r=rV(t,i,n.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<n.length;e++){let t=n[e];T(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=ia(i,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(i.toString(),a,r=>{rW(t,"transaction put response",{path:i.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<n.length;e++)n[e].status=2,s=s.concat(n6(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&r.push(()=>n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved)),n[e].unwatcher();rY(t,r_(t.transactionQueueTree_,i)),e(t,t.transactionQueueTree_),rM(t.eventQueue_,i,s);for(let e=0;e<r.length;e++)tM(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{tb("transaction at "+i.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}r$(t,i)}},o)}(t,rb(i),n)}else ry(i)&&rv(i,i=>{e(t,i)})})(e,e.transactionQueueTree_)}(e,r,n),n}function rK(e,t){let i;let n=e.transactionQueueTree_;for(i=t9(t);null!==i&&void 0===rm(n);)n=r_(n,i),i=t9(t=ie(t));return n}function rG(e,t){let i=[];return function e(t,i,n){let r=rm(i);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);rv(i,i=>{e(t,i,n)})}(e,t,i),i.sort((e,t)=>e.order-t.order),i}function rY(e,t){let i=rm(t);if(i){let e=0;for(let t=0;t<i.length;t++)2!==i[t].status&&(i[e]=i[t],e++);i.length=e,rg(t,i.length>0?i:void 0)}rv(t,t=>{rY(e,t)})}function rQ(e,t){let i=rb(rK(e,t)),n=r_(e.transactionQueueTree_,t);return function(e,t,i){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(n,t=>{rJ(e,t)}),rJ(e,n),function e(t,i,n,r){n&&!r&&i(t),rv(t,t=>{e(t,i,!0,r)}),n&&r&&i(t)}(n,t=>{rJ(e,t)}),i}function rJ(e,t){let i=rm(t);if(i){let n=[],r=[],s=-1;for(let t=0;t<i.length;t++)3===i[t].status||(1===i[t].status?(T(s===t-1,"All SENT items should be at beginning of queue."),s=t,i[t].status=3,i[t].abortReason="set"):(T(0===i[t].status,"Unexpected transaction status in abort"),i[t].unwatcher(),r=r.concat(n6(e.serverSyncTree_,i[t].currentWriteId,!0)),i[t].onComplete&&n.push(i[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?rg(t,void 0):i.length=s+1,rM(e.eventQueue_,rb(t),r);for(let e=0;e<n.length;e++)tM(n[e])}}let rZ=function(e,t){let i=rX(e),n=i.namespace;"firebase.com"===i.domain&&tv(i.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===i.domain||tv("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),i.secure||tw();let r="ws"===i.scheme||"wss"===i.scheme;return{repoInfo:new tF(i.host,i.secure,n,r,t,"",n!==i.subdomain),path:new t8(i.pathString)}},rX=function(e){let t="",i="",n="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(r=function(e){let t="",i=e.split("/");for(let e=0;e<i.length;e++)if(i[e].length>0){let n=i[e];try{n=decodeURIComponent(n.replace(/\+/g," "))}catch(e){}t+="/"+n}return t}(e.substring(c,u)));let d=function(e){let t={};for(let i of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===i.length)continue;let n=i.split("=");2===n.length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):tb(`Invalid query segment '${i}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let p=t.slice(0,h);if("localhost"===p.toLowerCase())i="localhost";else if(p.split(".").length<=2)i=p;else{let e=t.indexOf(".");n=t.substring(0,e).toLowerCase(),i=t.substring(e+1),s=n}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:i,subdomain:n,secure:o,scheme:a,pathString:r,namespace:s}};class r0{constructor(e,t,i,n){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=n}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class r1{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class r2{constructor(e,t,i,n){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=n}get key(){return io(this._path)?null:it(this._path)}get ref(){return new r6(this._repo,this._path)}get _queryIdentifier(){let e=tN(iX(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return iX(this._queryParams)}isEqual(e){if(!((e=ep(e))instanceof r2))return!1;let t=this._repo===e._repo,i=ih(this._path,e._path),n=this._queryIdentifier===e._queryIdentifier;return t&&i&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let i=e.pieceNum_;i<e.pieces_.length;i++)""!==e.pieces_[i]&&(t+="/"+encodeURIComponent(String(e.pieces_[i])));return t||"/"}(this._path)}}function r3(e){let t=null,i=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(i=e.getIndexEndValue()),e.getIndex()===ib){let n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==tS)throw Error(n);if("string"!=typeof t)throw Error(r)}if(e.hasEnd()){if(e.getIndexEndName()!==tI)throw Error(n);if("string"!=typeof i)throw Error(r)}}else if(e.getIndex()===iO){if(null!=t&&!rI(t)||null!=i&&!rI(i))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(T(e.getIndex() instanceof iB||e.getIndex()===iW,"unknown index type."),null!=t&&"object"==typeof t||null!=i&&"object"==typeof i)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function r4(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class r6 extends r2{constructor(e,t){super(e,t,new iJ,!1)}get parent(){let e=ir(this._path);return null===e?null:new r6(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class r8{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new t8(e),i=r5(this.ref,e);return new r8(this._node.getChild(t),i,iO)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,i)=>e(new r8(i,r5(this.ref,t),iO)))}hasChild(e){let t=new t8(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function r5(e,t){return null===t9((e=ep(e))._path)?rP("child","path",t,!1):rN("child","path",t,!1),new r6(e._repo,is(e._path,t))}class r9{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let i=t._queryParams.getIndex();return new r0("value",this,new r8(e.snapshotNode,new r6(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new r1(this,e,t):null}matches(e){return e instanceof r9&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class r7{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new r1(this,e,t):null}createEvent(e,t){assert(null!=e.childName,"Child events should have a childName.");let i=r5(new r6(t._repo,t._path),e.childName),n=t._queryParams.getIndex();return new r0(e.type,this,new r8(e.snapshotNode,i,n),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof r7&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}class se{}T(!p,"__referenceConstructor has already been defined"),p=r6,T(!f,"__referenceConstructor has already been defined"),f=r6;let st={};class si{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,i){if(e.stats_=tH(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new i0(e.repoInfo_,(t,i,n,r)=>{rU(e,t,i,n,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>rj(e,!0),0);else{if(null!=i){if("object"!=typeof i)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{Z(i)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new im(e.repoInfo_,t,(t,i,n,r)=>{rU(e,t,i,n,r)},t=>{rj(e,t)},t=>{tO(t,(t,i)=>{rB(e,t,i)})},e.authTokenProvider_,e.appCheckProvider_,i),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let i=e.toString();return tB[i]||(tB[i]=t()),tB[i]}(e.repoInfo_,()=>new i8(e.stats_,e.server_)),e.infoData_=new i1,e.infoSyncTree_=new n3({startListening:(t,i,n,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=n8(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),rB(e,"connected",!1),e.serverSyncTree_=new n3({startListening:(t,i,n,r)=>(e.server_.listen(t,n,i,(i,n)=>{let s=r(i,n);rM(e.eventQueue_,t._path,s)}),[]),stopListening:(t,i)=>{e.server_.unlisten(t,i)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new r6(this._repo,t5())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){let i=st[t];i&&i[e.key]===e||tv(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete i[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&tv("Cannot call "+e+" on a deleted database.")}}im.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},im.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},tz=te.Client,b="node",tW="10.13.2",eG(new ef("database",(e,{instanceIdentifier:t})=>(function(e,t,i,n,r){var s,o;let a,l,h,c,u=n||e.options.databaseURL;void 0===u&&(e.options.projectId||tv("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tm("Using default host for project ",e.options.projectId),u=`${e.options.projectId}-default-rtdb.firebaseio.com`);let d=rZ(u,void 0),p=d.repoInfo;"undefined"!=typeof process&&process.env&&(h=process.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(c=!0,p=(d=rZ(u=`http://${h}?ns=${p.namespace}`,void 0)).repoInfo):c=!d.repoInfo.secure;let f=r&&c?new tQ(tQ.OWNER):new tY(e.name,e.options,t);return rR("Invalid Firebase Database URL",d),io(d.path)||tv("Database URL must point to the root of a Firebase Database (not including a child path)."),new si((s=p,o=new tG(e.name,i),(a=st[e.name])||(a={},st[e.name]=a),(l=a[s.toURLString()])&&tv("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new rF(s,!1,f,o),a[s.toURLString()]=l,l),e)})(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),eX(t$,tK,b),eX(t$,tK,"esm2017");let sn="@firebase/installations",sr="0.6.9",ss=`w:${sr}`,so="FIS_v2",sa=new Y("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function sl(e){return e instanceof G&&e.code.includes("request-failed")}function sh({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function sc(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function su(e,t){let i=(await t.json()).error;return sa.create("request-failed",{requestName:e,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function sd({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function sp(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function sf({appConfig:e,heartbeatServiceProvider:t},{fid:i}){let n=sh(e),r=sd(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let o={method:"POST",headers:r,body:JSON.stringify({fid:i,authVersion:so,appId:e.appId,sdkVersion:ss})},a=await sp(()=>fetch(n,o));if(a.ok){let e=await a.json();return{fid:e.fid||i,registrationStatus:2,refreshToken:e.refreshToken,authToken:sc(e.authToken)}}throw await su("Create Installation",a)}function s_(e){return new Promise(t=>{setTimeout(t,e)})}let sm=/^[cdef][\w-]{21}$/;function sg(e){return`${e.appName}!${e.appId}`}let sy=new Map;function sv(e,t){let i=sg(e);sb(i,t),function(e,t){let i=(!sw&&"BroadcastChannel"in self&&((sw=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{sb(e.data.key,e.data.fid)}),sw);i&&i.postMessage({key:e,fid:t}),0===sy.size&&sw&&(sw.close(),sw=null)}(i,t)}function sb(e,t){let i=sy.get(e);if(i)for(let e of i)e(t)}let sw=null,sC="firebase-installations-store",sE=null;function sS(){return sE||(sE=eD("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(sC)}})),sE}async function sI(e,t){let i=sg(e),n=(await sS()).transaction(sC,"readwrite"),r=n.objectStore(sC),s=await r.get(i);return await r.put(t,i),await n.done,s&&s.fid===t.fid||sv(e,t.fid),t}async function sx(e){let t=sg(e),i=(await sS()).transaction(sC,"readwrite");await i.objectStore(sC).delete(t),await i.done}async function sT(e,t){let i=sg(e),n=(await sS()).transaction(sC,"readwrite"),r=n.objectStore(sC),s=await r.get(i),o=t(s);return void 0===o?await r.delete(i):await r.put(o,i),await n.done,o&&(!s||s.fid!==o.fid)&&sv(e,o.fid),o}async function sk(e){let t;let i=await sT(e.appConfig,i=>{let n=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(sa.create("app-offline"))};let i={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=sN(e,i);return{installationEntry:i,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:sP(e)}:{installationEntry:t}}(e,sR(i||{fid:function(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22);return sm.test(t)?t:""}catch(e){return""}}(),registrationStatus:0}));return t=n.registrationPromise,n.installationEntry});return""===i.fid?{installationEntry:await t}:{installationEntry:i,registrationPromise:t}}async function sN(e,t){try{let i=await sf(e,t);return sI(e.appConfig,i)}catch(i){throw sl(i)&&409===i.customData.serverCode?await sx(e.appConfig):await sI(e.appConfig,{fid:t.fid,registrationStatus:0}),i}}async function sP(e){let t=await sO(e.appConfig);for(;1===t.registrationStatus;)await s_(100),t=await sO(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:i}=await sk(e);return i||t}return t}function sO(e){return sT(e,e=>{if(!e)throw sa.create("installation-not-found");return sR(e)})}function sR(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function sD({appConfig:e,heartbeatServiceProvider:t},i){let n=function(e,{fid:t}){return`${sh(e)}/${t}/authTokens:generate`}(e,i),r=function(e,{refreshToken:t}){let i=sd(e);return i.append("Authorization",`${so} ${t}`),i}(e,i),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let o={method:"POST",headers:r,body:JSON.stringify({installation:{sdkVersion:ss,appId:e.appId}})},a=await sp(()=>fetch(n,o));if(a.ok)return sc(await a.json());throw await su("Generate Auth Token",a)}async function sA(e,t=!1){let i;let n=await sT(e.appConfig,n=>{var r;if(!sq(n))throw sa.create("not-registered");let s=n.authToken;if(!t&&2===(r=s).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(r))return n;if(1===s.requestStatus)return i=sM(e,t),n;{if(!navigator.onLine)throw sa.create("app-offline");let t=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(n);return i=sF(e,t),t}});return i?await i:n.authToken}async function sM(e,t){let i=await sL(e.appConfig);for(;1===i.authToken.requestStatus;)await s_(100),i=await sL(e.appConfig);let n=i.authToken;return 0===n.requestStatus?sA(e,t):n}function sL(e){return sT(e,e=>{var t;if(!sq(e))throw sa.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function sF(e,t){try{let i=await sD(e,t),n=Object.assign(Object.assign({},t),{authToken:i});return await sI(e.appConfig,n),i}catch(i){if(sl(i)&&(401===i.customData.serverCode||404===i.customData.serverCode))await sx(e.appConfig);else{let i=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await sI(e.appConfig,i)}throw i}}function sq(e){return void 0!==e&&2===e.registrationStatus}async function sU(e){let{installationEntry:t,registrationPromise:i}=await sk(e);return i?i.catch(console.error):sA(e).catch(console.error),t.fid}async function sj(e,t=!1){return await sB(e),(await sA(e,t)).token}async function sB(e){let{registrationPromise:t}=await sk(e);t&&await t}function sH(e){return sa.create("missing-app-config-values",{valueName:e})}let sW="installations";eG(new ef(sW,e=>{let t=e.getProvider("app").getImmediate(),i=function(e){if(!e||!e.options)throw sH("App Configuration");if(!e.name)throw sH("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw sH(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),n=eY(t,"heartbeat");return{app:t,appConfig:i,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},"PUBLIC")),eG(new ef("installations-internal",e=>{let t=eY(e.getProvider("app").getImmediate(),sW).getImmediate();return{getId:()=>sU(t),getToken:e=>sj(t,e)}},"PRIVATE")),eX(sn,sr),eX(sn,sr,"esm2017");let sz="analytics",sV="https://www.googletagmanager.com/gtag/js",s$=new eE("@firebase/analytics"),sK=new Y("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function sG(e){if(!e.startsWith(sV)){let t=sK.create("invalid-gtag-resource",{gtagURL:e});return s$.warn(t.message),""}return e}function sY(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function sQ(e,t,i,n,r,s){let o=n[r];try{if(o)await t[o];else{let e=(await sY(i)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(e){s$.error(e)}e("config",r,s)}async function sJ(e,t,i,n,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);let n=await sY(i);for(let i of e){let e=n.find(e=>e.measurementId===i),r=e&&t[e.appId];if(r)s.push(r);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",n,r||{})}catch(e){s$.error(e)}}class sZ{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let sX=new sZ;async function s0(e){var t;let{appId:i,apiKey:n}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":n})},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",i),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{let i=await o.json();(null===(t=i.error)||void 0===t?void 0:t.message)&&(e=i.error.message)}catch(e){}throw sK.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}async function s1(e,t=sX,i){let{appId:n,apiKey:r,measurementId:s}=e.options;if(!n)throw sK.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:n};throw sK.create("no-api-key")}let o=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new s3;return setTimeout(async()=>{a.abort()},void 0!==i?i:6e4),s2({appId:n,apiKey:r,measurementId:s},o,a,t)}async function s2(e,{throttleEndTimeMillis:t,backoffCount:i},n,r=sX){var s;let{appId:o,measurementId:a}=e;try{await new Promise((e,i)=>{let r=setTimeout(e,Math.max(t-Date.now(),0));n.addEventListener(()=>{clearTimeout(r),i(sK.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}catch(e){if(a)return s$.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{let t=await s0(e);return r.deleteThrottleMetadata(o),t}catch(h){if(!function(e){if(!(e instanceof G)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(h)){if(r.deleteThrottleMetadata(o),a)return s$.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:o,measurementId:a};throw h}let t=503===Number(null===(s=null==h?void 0:h.customData)||void 0===s?void 0:s.httpStatus)?ed(i,r.intervalMillis,30):ed(i,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:i+1};return r.setThrottleMetadata(o,l),s$.debug(`Calling attemptFetch again in ${t} millis`),s2(e,l,n,r)}}class s3{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function s4(e,t,i,n,r){if(r&&r.global){e("event",i,n);return}{let r=await t;e("event",i,Object.assign(Object.assign({},n),{send_to:r}))}}async function s6(){if(!$())return s$.warn(sK.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await K()}catch(e){return s$.warn(sK.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function s8(e,t,i,n,r,s,o){var a;let l=s1(e);l.then(t=>{i[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&s$.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>s$.error(e)),t.push(l);let h=s6().then(e=>e?n.getId():void 0),[c,u]=await Promise.all([l,h]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(sV)&&t.src.includes(e))return t;return null}(s)&&function(e,t){var i,n;let r;let s=(i="firebase-js-sdk-policy",n={createScriptURL:sG},window.trustedTypes&&(r=window.trustedTypes.createPolicy(i,n)),r),o=document.createElement("script"),a=`${sV}?l=${e}&id=${t}`;o.src=s?null==s?void 0:s.createScriptURL(a):a,o.async=!0,document.head.appendChild(o)}(s,c.measurementId),m&&(r("consent","default",m),m=void 0),r("js",new Date);let d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d.origin="firebase",d.update=!0,null!=u&&(d.firebase_id=u),r("config",c.measurementId,d),_&&(r("set",_),_=void 0),c.measurementId}class s5{constructor(e){this.app=e}_delete(){return delete s9[this.app.options.appId],Promise.resolve()}}let s9={},s7=[],oe={},ot="dataLayer",oi=!1,on="@firebase/analytics",or="0.10.8";eG(new ef(sz,(e,{options:t})=>(function(e,t,i){!function(){let e=[];if(function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),i=sK.create("invalid-analytics-context",{errorInfo:t});s$.warn(i.message)}}();let n=e.options.appId;if(!n)throw sK.create("no-app-id");if(!e.options.apiKey){if(e.options.measurementId)s$.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw sK.create("no-api-key")}if(null!=s9[n])throw sK.create("already-exists",{id:n});if(!oi){var r,s;let e,t;e=[],Array.isArray(window[ot])?e=window[ot]:window[ot]=e;let{wrappedGtag:i,gtagCore:n}=(r="gtag",t=function(...e){window[ot].push(arguments)},window[r]&&"function"==typeof window[r]&&(t=window[r]),window[r]=(s=t,async function(e,...t){try{if("event"===e){let[e,i]=t;await sJ(s,s9,s7,e,i)}else if("config"===e){let[e,i]=t;await sQ(s,s9,s7,oe,e,i)}else if("consent"===e){let[e,i]=t;s("consent",e,i)}else if("get"===e){let[e,i,n]=t;s("get",e,i,n)}else if("set"===e){let[e]=t;s("set",e)}else s(e,...t)}catch(e){s$.error(e)}}),{gtagCore:t,wrappedGtag:window[r]});y=i,g=n,oi=!0}return s9[n]=s8(e,s7,oe,t,g,ot,i),new s5(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),eG(new ef("analytics-internal",function(e){try{let t=e.getProvider(sz).getImmediate();return{logEvent:(e,i,n)=>{var r;return r=t,void(r=ep(r),s4(y,s9[r.app.options.appId],e,i,n).catch(e=>s$.error(e)))}}}catch(e){throw sK.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),eX(on,or),eX(on,or,"esm2017");let os=function(e=function(e=eH){let t=ez.get(e);if(!t&&e===eH&&H())return eZ();if(!t)throw eQ.create("no-app",{appName:e});return t}(),t){let i=eY(e,"database").getImmediate({identifier:void 0});if(!i._instanceStarted){let e=B("database");e&&function(e,t,i,n={}){var r;let s;(e=ep(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&tv("Cannot call useEmulator() after instance has already been initialized.");let o=e._repoInternal;o.repoInfo_.nodeAdmin?(n.mockUserToken&&tv('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new tQ(tQ.OWNER)):n.mockUserToken&&(s=new tQ("string"==typeof n.mockUserToken?n.mockUserToken:function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let i=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[A(JSON.stringify({alg:"none",type:"JWT"})),A(JSON.stringify(s)),""].join(".")}(n.mockUserToken,e.app.options.projectId))),r=s,o.repoInfo_=new tF(`${t}:${i}`,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams,!0),r&&(o.authTokenProvider_=r)}(i,...e)}return i}(eZ({apiKey:"AIzaSyAluYjiHKvNZp3fpg4J0NZIuME3hy_fsOU",authDomain:"isommelier-407eb.firebaseapp.com",projectId:"isommelier-407eb",storageBucket:"isommelier-407eb.appspot.com",messagingSenderId:"743577851125",appId:"1:743577851125:web:170abc6a978d532c15e1bc"})),oo=()=>{let[e,t]=(0,S.useState)(""),[i,n]=(0,S.useState)(""),[r,s]=(0,S.useState)(!1),[o,a]=(0,S.useState)({name:"",email:""}),[l,h]=(0,S.useState)(""),[c,u]=(0,S.useState)(""),d=(0,I.useRouter)();(0,S.useEffect)(()=>{let e=localStorage.getItem("name")||"",i=localStorage.getItem("email")||"";t(e),n(i)},[]);let p=async t=>{t.preventDefault();let n=!0,s={name:"",email:""};if(h(""),u(""),e||(s.name="Name is required.",n=!1),i?/\S+@\S+\.\S+/.test(i)||(s.email="Email is invalid.",n=!1):(s.email="Email is required.",n=!1),a(s),n)try{await function(e,t){rO("set",(e=ep(e))._path),rx("set",t,e._path,!1);let i=new W;return function(e,t,i,n,r){rW(e,"set",{path:t.toString(),value:i,priority:null});let s=rq(e),o=ij(i,null),a=rd(o,n9(e.serverSyncTree_,t),s),l=rH(e),h=n4(e.serverSyncTree_,t,a,l,!0);rA(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),(i,n)=>{let s="ok"===i;s||tb("set at "+t+" failed: "+i);let o=n6(e.serverSyncTree_,l,!s);rM(e.eventQueue_,t,o),rz(e,r,i,n)});let c=rQ(e,t);r$(e,c),rM(e.eventQueue_,c,[])}(e._repo,e._path,t,null,i.wrapCallback(()=>{})),i.promise}(function(e,t){return(e=ep(e))._checkNotDeleted("ref"),void 0!==t?r5(e._root,t):e._root}(os,"users/"+e),{name:e,email:i}),r?(localStorage.setItem("name",e),localStorage.setItem("email",i)):(localStorage.removeItem("name"),localStorage.removeItem("email")),u("Congratulations! You have successfully signed up."),setTimeout(()=>{d.push("/compare")},2e3)}catch(e){console.error("Error writing to database:",e),h("An error occurred. Please try again later.")}};return(0,E.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-6",children:[E.jsx("h1",{className:"text-4xl font-extrabold mb-8 text-cyan-600",children:"Sign Up"}),E.jsx("div",{className:"bg-white p-10 rounded-lg shadow-lg w-full max-w-md border border-gray-200",children:(0,E.jsxs)("form",{id:"signUpForm",className:"flex flex-col space-y-6",onSubmit:p,children:[(0,E.jsxs)("div",{children:[E.jsx("label",{htmlFor:"name",className:"block text-lg font-semibold mb-2 text-gray-700",children:"Name"}),E.jsx("input",{id:"name",type:"text",value:e,onChange:e=>t(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-cyan-500"}),o.name&&E.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.name})]}),(0,E.jsxs)("div",{children:[E.jsx("label",{htmlFor:"email",className:"block text-lg font-semibold mb-2 text-gray-700",children:"Email"}),E.jsx("input",{id:"email",type:"email",value:i,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-black focus:outline-none focus:ring-2 focus:ring-cyan-500"}),o.email&&E.jsx("p",{className:"text-red-500 text-sm mt-1",children:o.email})]}),(0,E.jsxs)("div",{className:"flex items-center space-x-2",children:[E.jsx("input",{id:"rememberMe",type:"checkbox",checked:r,onChange:e=>s(e.target.checked),className:"h-5 w-5 text-cyan-500 border-gray-300 rounded focus:ring-cyan-500"}),E.jsx("label",{htmlFor:"rememberMe",className:"text-gray-700 text-sm",children:"Remember my name and email"})]}),l&&E.jsx("p",{className:"text-red-500 text-sm mt-1",children:l}),c&&E.jsx("p",{className:"text-green-500 text-sm mt-1",children:c}),E.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-blue-600 transition duration-300 ease-in-out",children:"Sign Up"})]})})]})}},3012:(e,t,i)=>{"use strict";i.d(t,{default:()=>a});var n=i(326),r=i(7577),s=i(5047),o=i(6226);let a=()=>{let[e,t]=(0,r.useState)(""),i=(0,s.useRouter)(),a=e=>{i.push(e)};return n.jsx("nav",{className:"p-6 shadow-lg",style:{backgroundColor:"#03045e"},children:(0,n.jsxs)("div",{className:"container mx-auto flex items-center justify-between",children:[n.jsx("div",{className:"flex-shrink-0 transition-transform duration-300 ease-in-out hover:scale-105",children:n.jsx(o.default,{src:"/iSomillier-logo.png",alt:"iSommelier Logo",width:110,height:110})}),n.jsx("div",{className:"flex-grow flex justify-center",children:n.jsx("div",{className:"relative w-full max-w-lg",children:(0,n.jsxs)("form",{onSubmit:t=>{t.preventDefault(),console.log("Search Query:",e)},className:"relative flex items-center",children:[n.jsx("input",{type:"text",className:"w-full h-12 p-4 pr-16 rounded-full border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-lg text-black transition-transform duration-300 ease-in-out hover:shadow-xl",placeholder:"Search for wines, regions, or varietals...",value:e,onChange:e=>t(e.target.value)}),n.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-700 text-white px-6 py-2 rounded-full hover:bg-blue-800 transition-colors duration-300 ease-in-out",children:"Search"})]})})}),n.jsx("div",{className:"flex items-center space-x-8",children:(0,n.jsxs)("ul",{className:"flex space-x-8 text-lg font-semibold",children:[n.jsx("li",{className:"relative group",children:(0,n.jsxs)("button",{onClick:()=>a("/"),className:"text-gray-200 flex items-center hover:text-yellow-400",children:[n.jsx("span",{className:"relative",children:"Home"}),n.jsx("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-yellow-400 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"})]})}),n.jsx("li",{className:"relative group",children:(0,n.jsxs)("button",{onClick:()=>a("/about"),className:"text-gray-200 flex items-center hover:text-yellow-400",children:[n.jsx("span",{className:"relative",children:"About"}),n.jsx("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-yellow-400 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"})]})}),n.jsx("li",{className:"relative group",children:(0,n.jsxs)("button",{onClick:()=>a("/wishlist"),className:"text-gray-200 flex items-center hover:text-yellow-400",children:[n.jsx("span",{className:"relative",children:"Wishlist"}),n.jsx("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-yellow-400 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"})]})}),n.jsx("li",{className:"relative group",children:(0,n.jsxs)("button",{onClick:()=>a("/feedback"),className:"text-gray-200 flex items-center hover:text-yellow-400",children:[n.jsx("span",{className:"relative",children:"Feedback"}),n.jsx("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-yellow-400 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"})]})}),n.jsx("li",{className:"relative group",children:(0,n.jsxs)("button",{onClick:()=>a("/signup"),className:"text-gray-200 flex items-center hover:text-yellow-400",children:[n.jsx("span",{className:"relative",children:"Sign Up"}),n.jsx("span",{className:"absolute bottom-0 left-0 w-full h-1 bg-yellow-400 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100"})]})})]})})]})})}},9901:(e,t,i)=>{"use strict";var n=i(2781).Stream,r=i(3837),s=i(8679),o=i(5766),a=i(7861),l=i(6466),h=i(8413),c=function(e,t,i){this.writable=!0,i=i||{},this._stream=t.socket,this._ping=i.ping||this.DEFAULT_PING,this._retry=i.retry||this.DEFAULT_RETRY;var n=s.isSecureRequest(e)?"https:":"http:";this.url=n+"//"+e.headers.host+e.url,this.lastEventId=e.headers["last-event-id"]||"",this.readyState=a.CONNECTING;var r=new o,l=this;if(i.headers)for(var h in i.headers)r.set(h,i.headers[h]);if(this._stream&&this._stream.writable){process.nextTick(function(){l._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var c="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+r.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(c),this._stream.on("drain",function(){l.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){l.ping()},1e3*this._ping)),["error","end"].forEach(function(e){l._stream.on(e,function(){l.close()})})}};r.inherits(c,n),c.isEventSource=function(e){return"GET"===e.method&&(e.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var u={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(e){if(!this.writable)return!1;try{return this._stream.write(e,"utf8")}catch(e){return!1}},_open:function(){if(this.readyState===a.CONNECTING){this.readyState=a.OPEN;var e=new h("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.write(e),this.close()},send:function(e,t){if(this.readyState>a.OPEN)return!1;e=String(e).replace(/(\r\n|\r|\n)/g,"$1data: ");var i="";return(t=t||{}).event&&(i+="event: "+t.event+"\r\n"),t.id&&(i+="id: "+t.id+"\r\n"),i+="data: "+e+"\r\n\r\n",this._write(i)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>a.OPEN)return!1;this.readyState=a.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var e=new h("close");return e.initEvent("close",!1,!1),this.dispatchEvent(e),!0}};for(var d in u)c.prototype[d]=u[d];for(var p in l)c.prototype[p]=l[p];e.exports=c},3968:(e,t,i)=>{"use strict";var n=i(3837),r=i(8679),s=i(7861),o=function(e,t,i,n,o){o=o||{},this._stream=t,this._driver=r.http(e,{maxLength:o.maxLength,protocols:n});var a=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var l=function(){a._stream.removeListener("data",l)};this._stream.on("data",l),s.call(this,o),process.nextTick(function(){a._driver.start(),a._driver.io.write(i)})}};n.inherits(o,s),o.isWebSocket=function(e){return r.isWebSocket(e)},o.validateOptions=function(e,t){r.validateOptions(e,t)},o.WebSocket=o,o.Client=i(1282),o.EventSource=i(9901),e.exports=o},7861:(e,t,i)=>{"use strict";var n=i(2781).Stream,r=i(3837),s=i(8679),o=i(6466),a=i(8413),l=function(e){e=e||{},s.validateOptions(e,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var t=e.headers;if(t)for(var i in t)this._driver.setHeader(i,t[i]);var n=e.extensions;n&&[].concat(n).forEach(this._driver.addExtension,this._driver),this._ping=e.ping,this._pingId=0,this.readyState=l.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var r=this;this._driver.on("open",function(e){r._open()}),this._driver.on("message",function(e){r._receiveMessage(e.data)}),this._driver.on("close",function(e){r._beginClose(e.reason,e.code)}),this._driver.on("error",function(e){r._emitError(e.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){r.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){r._pingId+=1,r.ping(r._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};r.inherits(l,n),l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.CLOSE_TIMEOUT=3e4;var h={write:function(e){return this.send(e)},end:function(e){void 0!==e&&this.send(e),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(e){return!(this.readyState>l.OPEN)&&(e instanceof Buffer||(e=String(e)),this._driver.messages.write(e))},ping:function(e,t){return!(this.readyState>l.OPEN)&&this._driver.ping(e,t)},close:function(e,t){if(void 0===e&&(e=1e3),void 0===t&&(t=""),1e3!==e&&(e<3e3||e>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+e+" is neither.");if(this.readyState<l.CLOSING){var i=this;this._closeTimer=setTimeout(function(){i._beginClose("",1006)},l.CLOSE_TIMEOUT)}this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING),this._driver.close(t,e)},_configureStream:function(){var e=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(t){this._stream.on(t,function(){e._finalizeClose()})},this),this._stream.on("error",function(t){e._emitError("Network error: "+e.url+": "+t.message),e._finalizeClose()})},_open:function(){if(this.readyState===l.CONNECTING){this.readyState=l.OPEN,this.protocol=this._driver.protocol||"";var e=new a("open");e.initEvent("open",!1,!1),this.dispatchEvent(e)}},_receiveMessage:function(e){if(this.readyState>l.OPEN)return!1;this.readable&&this.emit("data",e);var t=new a("message",{data:e});t.initEvent("message",!1,!1),this.dispatchEvent(t)},_emitError:function(e){if(!(this.readyState>=l.CLOSING)){var t=new a("error",{message:e});t.initEvent("error",!1,!1),this.dispatchEvent(t)}},_beginClose:function(e,t){this.readyState!==l.CLOSED&&(this.readyState=l.CLOSING,this._closeParams=[e,t],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==l.CLOSED){this.readyState=l.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var e=this._closeParams?this._closeParams[0]:"",t=new a("close",{code:this._closeParams?this._closeParams[1]:1006,reason:e});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(var c in h)l.prototype[c]=h[c];for(var u in o)l.prototype[u]=o[u];e.exports=l},8413:e=>{"use strict";var t=function(e,t){for(var i in this.type=e,t)this[i]=t[i]};t.prototype.initEvent=function(e,t,i){this.type=e,this.bubbles=t,this.cancelable=i},t.prototype.stopPropagation=function(){},t.prototype.preventDefault=function(){},t.CAPTURING_PHASE=1,t.AT_TARGET=2,t.BUBBLING_PHASE=3,e.exports=t},6466:(e,t,i)=>{"use strict";var n=i(8413);e.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(e,t,i){this.on(e,t)},removeEventListener:function(e,t,i){this.removeListener(e,t)},dispatchEvent:function(e){e.target=e.currentTarget=this,e.eventPhase=n.AT_TARGET,this["on"+e.type]&&this["on"+e.type](e),this.emit(e.type,e)}}},1282:(e,t,i)=>{"use strict";var n=i(3837),r=i(1808),s=i(4404),o=i(7310),a=i(8679),l=i(7861);i(8413);var h={"http:":80,"https:":443,"ws:":80,"wss:":443},c=["https:","wss:"],u=function(e,t,i){i=i||{},this.url=e,this._driver=a.client(this.url,{maxLength:i.maxLength,protocols:t}),["open","error"].forEach(function(e){this._driver.on(e,function(){y.headers=y._driver.headers,y.statusCode=y._driver.statusCode})},this);var n=i.proxy||{},u=o.parse(n.origin||this.url),d=u.port||h[u.protocol],p=c.indexOf(u.protocol)>=0,f=function(){y._onConnect()},_=i.net||{},m=i.tls||{},g=n.origin?n.tls||{}:m,y=this;_.host=g.host=u.hostname,_.port=g.port=d,m.ca=m.ca||i.ca,g.servername=g.servername||u.hostname,this._stream=p?s.connect(g,f):r.connect(_,f),n.origin&&this._configureProxy(n,m),l.call(this,i)};n.inherits(u,l),u.prototype._onConnect=function(){(this._proxy||this._driver).start()},u.prototype._configureProxy=function(e,t){var i,n=o.parse(this.url),r=c.indexOf(n.protocol)>=0,a=this;if(this._proxy=this._driver.proxy(e.origin),e.headers)for(i in e.headers)this._proxy.setHeader(i,e.headers[i]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var e={socket:a._stream,servername:n.hostname};for(i in t)e[i]=t[i];a._stream=s.connect(e),a._configureStream()}a._driver.io.pipe(a._stream),a._stream.pipe(a._driver.io),a._driver.start()}),this._proxy.on("error",function(e){a._driver.emit("error",e)})},e.exports=u},5433:(e,t,i)=>{var n=i(9491);function r(e){n.ok(e===r.REQUEST||e===r.RESPONSE||void 0===e),void 0===e||this.initialize(e),this.maxHeaderSize=r.maxHeaderSize}t.m=r,r.prototype.initialize=function(e,t){n.ok(e===r.REQUEST||e===r.RESPONSE),this.type=e,this.state=e+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},r.encoding="ascii",r.maxHeaderSize=81920,r.REQUEST="REQUEST",r.RESPONSE="RESPONSE";var s=r.kOnHeaders=1,o=r.kOnHeadersComplete=2,a=r.kOnBody=3,l=r.kOnMessageComplete=4;r.prototype[s]=r.prototype[o]=r.prototype[a]=r.prototype[l]=function(){};var h=!0;Object.defineProperty(r,"kOnExecute",{get:function(){return h=!1,99}});var c=r.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],u=c.indexOf("CONNECT");r.prototype.reinitialize=r,r.prototype.close=r.prototype.pause=r.prototype.resume=r.prototype.free=function(){},r.prototype._compatMode0_11=!1,r.prototype.getAsyncId=function(){return 0};var d={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};r.prototype.execute=function(e,t,i){if(!(this instanceof r))throw TypeError("not a HTTPParser");t=t||0,i="number"==typeof i?i:e.length,this.chunk=e,this.offset=t;var n=this.end=t+i;try{for(;this.offset<n&&!this[this.state](););}catch(e){if(this.isUserCall)throw e;return this.hadError=!0,e}return(this.chunk=null,i=this.offset-t,d[this.state]&&(this.headerSize+=i,this.headerSize>(this.maxHeaderSize||r.maxHeaderSize)))?Error("max header size exceeded"):i};var p={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};r.prototype.finish=function(){if(!this.hadError){if(!p[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[l]())}},r.prototype.consume=r.prototype.unconsume=r.prototype.getCurrentBuffer=function(){},r.prototype.userCall=function(){this.isUserCall=!0;var e=this;return function(t){return e.isUserCall=!1,t}},r.prototype.nextRequest=function(){this.userCall()(this[l]()),this.reinitialize(this.type)},r.prototype.consumeLine=function(){for(var e=this.end,t=this.chunk,i=this.offset;i<e;i++)if(10===t[i]){var n=this.line+t.toString(r.encoding,this.offset,i);return"\r"===n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),this.line="",this.offset=i+1,n}this.line+=t.toString(r.encoding,this.offset,this.end),this.offset=this.end};var f=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,_=/^[ \t]+(.*[^ \t])/;r.prototype.parseHeader=function(e,t){if(-1!==e.indexOf("\r"))throw y("HPE_LF_EXPECTED");var i=f.exec(e),n=i&&i[1];if(n)t.push(n),t.push(i[2]);else{var r=_.exec(e);r&&t.length&&(t[t.length-1]&&(t[t.length-1]+=" "),t[t.length-1]+=r[1])}};var m=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;r.prototype.REQUEST_LINE=function(){var e=this.consumeLine();if(e){var t=m.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?t[1]:c.indexOf(t[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=t[2],this.info.versionMajor=+t[3],this.info.versionMinor=+t[4],this.body_bytes=0,this.state="HEADER"}};var g=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function y(e){var t=Error("Parse Error");return t.code=e,t}r.prototype.RESPONSE_LINE=function(){var e=this.consumeLine();if(e){var t=g.exec(e);if(null===t)throw y("HPE_INVALID_CONSTANT");this.info.versionMajor=+t[1],this.info.versionMinor=+t[2];var i=this.info.statusCode=+t[3];this.info.statusMessage=t[4],((i/100|0)==1||204===i||304===i)&&(this.body_bytes=0),this.state="HEADER"}},r.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},r.prototype.HEADER=function(){var e=this.consumeLine();if(void 0!==e){var t=this.info;if(e)this.parseHeader(e,t.headers);else{for(var i,n,s=t.headers,a=!1,l=!1,c=0;c<s.length;c+=2)switch(s[c].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===s[c+1].toLowerCase();break;case"content-length":if(i=+s[c+1],a){if(i!==this.body_bytes)throw y("HPE_UNEXPECTED_CONTENT_LENGTH")}else a=!0,this.body_bytes=i;break;case"connection":this.connection+=s[c+1].toLowerCase();break;case"upgrade":l=!0}if(this.isChunked&&a&&(a=!1,this.body_bytes=null),l&&-1!=this.connection.indexOf("upgrade")?t.upgrade=this.type===r.REQUEST||101===t.statusCode:t.upgrade=t.method===u,this.isChunked&&t.upgrade&&(this.isChunked=!1),t.shouldKeepAlive=this.shouldKeepAlive(),2===(n=h?this.userCall()(this[o](t)):this.userCall()(this[o](t.versionMajor,t.versionMinor,t.headers,t.method,t.url,t.statusCode,t.statusMessage,t.upgrade,t.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!n)this.state="BODY_CHUNKHEAD";else{if(n||0===this.body_bytes)return this.nextRequest(),t.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},r.prototype.BODY_CHUNKHEAD=function(){var e=this.consumeLine();void 0!==e&&(this.body_bytes=parseInt(e,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},r.prototype.BODY_CHUNK=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},r.prototype.BODY_CHUNKEMPTYLINE=function(){var e=this.consumeLine();void 0!==e&&(n.equal(e,""),this.state="BODY_CHUNKHEAD")},r.prototype.BODY_CHUNKTRAILERS=function(){var e=this.consumeLine();void 0!==e&&(e?this.parseHeader(e,this.trailers):(this.trailers.length&&this.userCall()(this[s](this.trailers,"")),this.nextRequest()))},r.prototype.BODY_RAW=function(){var e=this.end-this.offset;this.userCall()(this[a](this.chunk,this.offset,e)),this.offset=this.end},r.prototype.BODY_SIZED=function(){var e=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[a](this.chunk,this.offset,e)),this.offset+=e,this.body_bytes-=e,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(e){var t=r["kOn"+e];Object.defineProperty(r.prototype,"on"+e,{get:function(){return this[t]},set:function(e){return this._compatMode0_11=!0,u="CONNECT",this[t]=e}})})},892:(e,t,i)=>{var n=i(4300),r=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function o(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=o),o.prototype=Object.create(r.prototype),s(r,o),o.from=function(e,t,i){if("number"==typeof e)throw TypeError("Argument must not be a number");return r(e,t,i)},o.alloc=function(e,t,i){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=r(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},o.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},8679:(e,t,i)=>{"use strict";var n=i(6070),r=i(7729),s=i(2949);e.exports={client:function(e,t){return void 0===(t=t||{}).masking&&(t.masking=!0),new r(e,t)},server:function(e){return void 0===(e=e||{}).requireMasking&&(e.requireMasking=!0),new s(e)},http:function(){return s.http.apply(s,arguments)},isSecureRequest:function(e){return s.isSecureRequest(e)},isWebSocket:function(e){return n.isWebSocket(e)},validateOptions:function(e,t){n.validateOptions(e,t)}}},6070:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(2361).EventEmitter,s=i(3837),o=i(9242),a=i(5766),l=i(5828),h=function(e,t,i){r.call(this),h.validateOptions(i||{},["maxLength","masking","requireMasking","protocols"]),this._request=e,this._reader=new l,this._options=i||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new a,this.__queue=[],this.readyState=0,this.url=t,this.io=new o.IO(this),this.messages=new o.Messages(this),this._bindEventListeners()};s.inherits(h,r),h.isWebSocket=function(e){var t=e.headers.connection||"",i=e.headers.upgrade||"";return"GET"===e.method&&t.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===i.toLowerCase()},h.validateOptions=function(e,t){for(var i in e)if(0>t.indexOf(i))throw Error("Unrecognized option: "+i)};var c={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var e=this;this.messages.on("error",function(){}),this.on("message",function(t){var i=e.messages;i.readable&&i.emit("data",t.data)}),this.on("error",function(t){var i=e.messages;i.readable&&i.emit("error",t)}),this.on("close",function(){var t=e.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(e){return!1},setHeader:function(e,t){return!(this.readyState>0)&&(this._headers.set(e,t),!0)},start:function(){var e;if(0!==this.readyState)return!1;if(!h.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{e=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(e),-1!==this._stage&&this._open(),!0},_failHandshake:function(e){var t=new a;return t.set("Content-Type","text/plain"),t.set("Content-Length",n.byteLength(e.message,"utf8")),t=["HTTP/1.1 400 Bad Request",t.toString(),e.message],this._write(n.from(t.join("\r\n"),"utf8")),this._fail("protocol_error",e.message),!1},text:function(e){return this.frame(e)},binary:function(e){return!1},ping:function(){return!1},pong:function(){return!1},close:function(e,t){return 1===this.readyState&&(this.readyState=3,this.emit("close",new h.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(e){this.frame.apply(this,e)},this),this.__queue=[],this.emit("open",new h.OpenEvent)},_queue:function(e){return this.__queue.push(e),!0},_write:function(e){var t=this.io;t.readable&&t.emit("data",e)},_fail:function(e,t){this.readyState=2,this.emit("error",Error(t)),this.close()}};for(var u in c)h.prototype[u]=c[u];h.ConnectEvent=function(){},h.OpenEvent=function(){},h.CloseEvent=function(e,t){this.code=e,this.reason=t},h.MessageEvent=function(e){this.data=e},h.PingEvent=function(e){this.data=e},h.PongEvent=function(e){this.data=e},e.exports=h},7729:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(6113),s=i(7310),o=i(3837),a=i(1258),l=i(6070),h=i(5270),c=i(4967),u=function(e,t){this.version="hybi-"+h.VERSION,h.call(this,null,e,t),this.readyState=-1,this._key=u.generateKey(),this._accept=h.generateAccept(this._key),this._http=new a("response");var i=s.parse(this.url),r=i.auth&&n.from(i.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(i.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(i.pathname||"/")+(i.search||""),this._headers.set("Host",i.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",h.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};o.inherits(u,h),u.generateKey=function(){return r.randomBytes(16).toString("base64")};var d={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(e,t){return new c(this,e,t)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(e){if(3!==this.readyState){if(this.readyState>0)return h.prototype.parse.call(this,e);this._http.parse(e),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var e=this._extensions.generateOffer();e&&this._headers.set("Sec-WebSocket-Extensions",e);var t=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return n.from(t.join("\r\n"),"utf8")},_failHandshake:function(e){e="Error during WebSocket handshake: "+e,this.readyState=3,this.emit("error",Error(e)),this.emit("close",new l.CloseEvent(this.ERRORS.protocol_error,e))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var e=this._http.headers,t=e.upgrade||"",i=e.connection||"",n=e["sec-websocket-accept"]||"",r=e["sec-websocket-protocol"]||"";if(""===t)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==t.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===i)return this._failHandshake("'Connection' header is missing");if("upgrade"!==i.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(n!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==r){if(0>this._protocols.indexOf(r))return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=r}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(e){return this._failHandshake(e.message)}}};for(var p in d)u.prototype[p]=d[p];e.exports=u},2441:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(6070),s=i(3837),o=function(e,t,i){r.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};s.inherits(o,r);var a={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new r.CloseEvent(null,null)),!0)},parse:function(e){this.readyState>1||(this._reader.put(e),this._reader.eachByte(function(e){var t;switch(this._stage){case -1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(127&e)+128*this._length,this._closing&&0===this._length)return this.close();(128&e)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===e)this._stage=0,t=n.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new r.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(e){if(0===this.readyState)return this._queue([e]);if(this.readyState>1)return!1;"string"!=typeof e&&(e=e.toString());var t=n.byteLength(e),i=n.allocUnsafe(t+2);return i[0]=0,i.write(e,1),i[i.length-1]=255,this._write(i),!0},_handshakeResponse:function(){var e=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"utf8")},_parseLeadingByte:function(e){(128&e)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var l in a)o.prototype[l]=a[l];e.exports=o},3376:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(6070),s=i(2441),o=i(6113),a=i(3837),l=function(e){return parseInt((e.match(/[0-9]/g)||[]).join(""),10)},h=function(e){return(e.match(/ /g)||[]).length},c=function(e,t,i){s.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};a.inherits(c,s);var u={BODY_SIZE:8,start:function(){return!!s.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(n.from([255,0])),this.readyState=3,this.emit("close",new r.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var e=this._request.headers,t=e["sec-websocket-key1"],i=e["sec-websocket-key2"];if(!t)throw Error("Missing required header: Sec-WebSocket-Key1");if(!i)throw Error("Missing required header: Sec-WebSocket-Key2");var r=l(t),s=h(t),o=l(i),a=h(i);if(r%s!=0||o%a!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[r/s,o/a];var e=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return n.from(e.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var e=o.createHash("md5"),t=n.allocUnsafe(8+this.BODY_SIZE);return t.writeUInt32BE(this._keyValues[0],0),t.writeUInt32BE(this._keyValues[1],4),n.from(this._body).copy(t,8,0,this.BODY_SIZE),e.update(t),n.from(e.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var e=this._handshakeSignature();e&&(this._write(e),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(e){if(255!==e)return s.prototype._parseLeadingByte.call(this,e);this._closing=!0,this._length=0,this._stage=1}};for(var d in u)c.prototype[d]=u[d];e.exports=c},5766:e=>{"use strict";var t=function(){this.clear()};t.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],t.prototype.clear=function(){this._sent={},this._lines=[]},t.prototype.set=function(e,t){if(void 0!==t){e=this._strip(e),t=this._strip(t);var i=e.toLowerCase();(!this._sent.hasOwnProperty(i)||this.ALLOWED_DUPLICATES.indexOf(i)>=0)&&(this._sent[i]=!0,this._lines.push(e+": "+t+"\r\n"))}},t.prototype.toString=function(){return this._lines.join("")},t.prototype._strip=function(e){return e.toString().replace(/^ */,"").replace(/ *$/,"")},e.exports=t},5270:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(6113),s=i(3837),o=i(5056),a=i(6070),l=i(4722),h=i(8996),c=function(e,t,i){if(a.apply(this,arguments),this._extensions=new o,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var n=this._request.headers["sec-websocket-protocol"],r=this._protocols;void 0!==n&&("string"==typeof n&&(n=n.split(/ *, */)),this.protocol=n.filter(function(e){return r.indexOf(e)>=0})[0]),this.version="hybi-"+c.VERSION}};s.inherits(c,a),c.VERSION="13",c.mask=function(e,t,i){if(!t||0===t.length)return e;i=i||0;for(var n=0,r=e.length-i;n<r;n++)e[i+n]=e[i+n]^t[n%4];return e},c.generateAccept=function(e){var t=r.createHash("sha1");return t.update(e+c.GUID),t.digest("base64")},c.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var u={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(e){return this._extensions.add(e),!0},parse:function(e){this._reader.put(e);for(var t=!0;t;)switch(this._stage){case 0:(t=this._reader.read(1))&&this._parseOpcode(t[0]);break;case 1:(t=this._reader.read(1))&&this._parseLength(t[0]);break;case 2:(t=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(t);break;case 3:(t=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=t);break;case 4:(t=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(t));break;default:t=null}},text:function(e){return!(this.readyState>1)&&this.frame(e,"text")},binary:function(e){return!(this.readyState>1)&&this.frame(e,"binary")},ping:function(e,t){return!(this.readyState>1)&&(e=e||"",t&&(this._pingCallbacks[e]=t),this.frame(e,"ping"))},pong:function(e){return!(this.readyState>1)&&(e=e||"",this.frame(e,"pong"))},close:function(e,t){return(e=e||"",t=t||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new a.CloseEvent(t,e)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(e,"close",t)},this),!0)},frame:function(e,t,i){if(this.readyState<=0)return this._queue([e,t,i]);if(this.readyState>2)return!1;e instanceof Array&&(e=n.from(e)),"number"==typeof e&&(e=e.toString());var s,o,a=new h,c="string"==typeof e;a.rsv1=a.rsv2=a.rsv3=!1,a.opcode=this.OPCODES[t||(c?"text":"binary")],s=c?n.from(e,"utf8"):e,i&&(o=s,(s=n.allocUnsafe(2+o.length)).writeUInt16BE(i,0),o.copy(s,2)),a.data=s;var u=function(e){var t=new l;t.final=!0,t.rsv1=e.rsv1,t.rsv2=e.rsv2,t.rsv3=e.rsv3,t.opcode=e.opcode,t.masked=!!this._masking,t.length=e.data.length,t.payload=e.data,t.masked&&(t.maskingKey=r.randomBytes(4)),this._sendFrame(t)};return this.MESSAGE_OPCODES.indexOf(a.opcode)>=0?this._extensions.processOutgoingMessage(a,function(e,t){if(e)return this._fail("extension_error",e.message);u.call(this,t)},this):u.call(this,a),!0},_sendFrame:function(e){var t=e.length,i=t<=125?2:t<=65535?4:10,r=i+(e.masked?4:0),s=n.allocUnsafe(r+t),o=e.masked?this.MASK:0;s[0]=(e.final?this.FIN:0)|(e.rsv1?this.RSV1:0)|(e.rsv2?this.RSV2:0)|(e.rsv3?this.RSV3:0)|e.opcode,t<=125?s[1]=o|t:t<=65535?(s[1]=126|o,s.writeUInt16BE(t,2)):(s[1]=127|o,s.writeUInt32BE(Math.floor(t/4294967296),2),s.writeUInt32BE(t%4294967296,6)),e.payload.copy(s,r),e.masked&&(e.maskingKey.copy(s,i),c.mask(s,e.maskingKey,r)),this._write(s)},_handshakeResponse:function(){var e=this._request.headers["sec-websocket-key"],t=this._request.headers["sec-websocket-version"];if(t!==c.VERSION)throw Error("Unsupported WebSocket version: "+t);if("string"!=typeof e)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",c.generateAccept(e)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var i=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);i&&this._headers.set("Sec-WebSocket-Extensions",i);var r=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return n.from(r.join("\r\n"),"utf8")},_shutdown:function(e,t,i){delete this._frame,delete this._message,this._stage=5;var n=1===this.readyState;this.readyState=2,this._extensions.close(function(){n&&this.frame(t,"close",e),this.readyState=3,i&&this.emit("error",Error(t)),this.emit("close",new a.CloseEvent(e,t))},this)},_fail:function(e,t){this.readyState>1||this._shutdown(this.ERRORS[e],t,!0)},_parseOpcode:function(e){var t=[this.RSV1,this.RSV2,this.RSV3].map(function(t){return(e&t)===t}),i=this._frame=new l;return(i.final=(e&this.FIN)===this.FIN,i.rsv1=t[0],i.rsv2=t[1],i.rsv3=t[2],i.opcode=e&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(i))?0>this.OPCODE_CODES.indexOf(i.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+i.opcode):0>this.MESSAGE_OPCODES.indexOf(i.opcode)&&!i.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+i.opcode):this._message&&this.OPENING_OPCODES.indexOf(i.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(i.rsv1?1:0)+", reserved2 = "+(i.rsv2?1:0)+", reserved3 = "+(i.rsv3?1:0))},_parseLength:function(e){var t=this._frame;if(t.masked=(e&this.MASK)===this.MASK,t.length=e&this.LENGTH,t.length>=0&&t.length<=125){if(this._stage=t.masked?3:4,!this._checkFrameLength())return}else this._stage=2,t.lengthBytes=126===t.length?2:8;if(this._requireMasking&&!t.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(e){var t=this._frame;if(t.length=this._readUInt(e),this._stage=t.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(t.opcode)&&t.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+t.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(e){var t,i,n,r,s,o=this._frame,l=o.payload=c.mask(e,o.maskingKey),u=o.opcode;if(delete this._frame,u===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(o)}if((u===this.OPCODES.text||u===this.OPCODES.binary)&&(this._message=new h,this._message.pushFrame(o)),o.final&&this.MESSAGE_OPCODES.indexOf(u)>=0)return this._emitMessage(this._message);u===this.OPCODES.close&&(i=l.length>=2?l.readUInt16BE(0):null,n=l.length>2?this._encode(l.slice(2)):null,0!==l.length&&!(null!==i&&i>=this.MIN_RESERVED_ERROR&&i<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(i)&&(i=this.ERRORS.protocol_error),(l.length>125||l.length>2&&!n)&&(i=this.ERRORS.protocol_error),this._shutdown(i||this.DEFAULT_ERROR_CODE,n||"")),u===this.OPCODES.ping&&(this.frame(l,"pong"),this.emit("ping",new a.PingEvent(l.toString()))),u===this.OPCODES.pong&&(s=(r=this._pingCallbacks)[t=this._encode(l)],delete r[t],s&&s(),this.emit("pong",new a.PongEvent(l.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(e,t){if(e)return this._fail("extension_error",e.message);var i=t.data;if(t.opcode===this.OPCODES.text&&(i=this._encode(i)),null===i)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new a.MessageEvent(i))},this)},_encode:function(e){try{var t=e.toString("binary",0,e.length);if(!this.UTF8_MATCH.test(t))return null}catch(e){}return e.toString("utf8",0,e.length)},_readUInt:function(e){return 2===e.length?e.readUInt16BE(0):4294967296*e.readUInt32BE(0)+e.readUInt32BE(4)}};for(var d in u)c.prototype[d]=u[d];e.exports=c},4722:e=>{"use strict";var t=function(){},i={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var n in i)t.prototype[n]=i[n];e.exports=t},8996:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},s={read:function(){return this.data=this.data||n.concat(this._chunks,this.length)},pushFrame:function(e){this.rsv1=this.rsv1||e.rsv1,this.rsv2=this.rsv2||e.rsv2,this.rsv3=this.rsv3||e.rsv3,null===this.opcode&&(this.opcode=e.opcode),this._chunks.push(e.payload),this.length+=e.length}};for(var o in s)r.prototype[o]=s[o];e.exports=r},4967:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=i(2781).Stream,s=i(7310),o=i(3837),a=i(6070),l=i(5766),h=i(1258),c={"ws:":80,"wss:":443},u=function(e,t,i){this._client=e,this._http=new h("response"),this._origin="object"==typeof e.url?e.url:s.parse(e.url),this._url="object"==typeof t?t:s.parse(t),this._options=i||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new l,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&n.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};o.inherits(u,r);var d={setHeader:function(e,t){return 0===this._state&&(this._headers.set(e,t),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var e=this._origin,t=e.port||c[e.protocol],i=["CONNECT "+e.hostname+":"+t+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",n.from(i.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(e){if(!this.writable)return!1;if(this._http.parse(e),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new a.ConnectEvent);else{var t="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(t))}return this.end(),!this._paused},end:function(e){this.writable&&(void 0!==e&&this.write(e),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var p in d)u.prototype[p]=d[p];e.exports=u},2949:(e,t,i)=>{"use strict";var n=i(3837),r=i(1258),s=i(6070),o=i(2441),a=i(3376),l=i(5270),h=function(e){s.call(this,null,null,e),this._http=new r("request")};n.inherits(h,s);var c={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(e){if(this._delegate)return this._delegate.parse(e);if(this._http.parse(e),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var t=this;this._delegate=h.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(e){this._delegate.on(e,function(i){t.emit(e,i)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new s.ConnectEvent)}},_open:function(){this.__queue.forEach(function(e){this._delegate[e[0]].apply(this._delegate,e[1])},this),this.__queue=[]}};for(var u in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(e){c[e]=function(){return this._delegate?this._delegate[e].apply(this._delegate,arguments):(this.__queue.push([e,arguments]),!0)}}),c)h.prototype[u]=c[u];h.isSecureRequest=function(e){if(e.connection&&void 0!==e.connection.authorized||e.socket&&e.socket.secure)return!0;var t=e.headers;return!!t&&("on"===t.https||"on"===t["x-forwarded-ssl"]||"https"===t["x-forwarded-scheme"]||"https"===t["x-forwarded-proto"])},h.determineUrl=function(e){return(this.isSecureRequest(e)?"wss:":"ws:")+"//"+e.headers.host+e.url},h.http=function(e,t){void 0===(t=t||{}).requireMasking&&(t.requireMasking=!0);var i=e.headers,n=i["sec-websocket-version"],r=i["sec-websocket-key"],s=i["sec-websocket-key1"],h=i["sec-websocket-key2"],c=this.determineUrl(e);return n||r?new l(e,c,t):s||h?new a(e,c,t):new o(e,c,t)},e.exports=h},5828:(e,t,i)=>{"use strict";var n=i(892).Buffer,r=function(){this._queue=[],this._queueSize=0,this._offset=0};r.prototype.put=function(e){e&&0!==e.length&&(n.isBuffer(e)||(e=n.from(e)),this._queue.push(e),this._queueSize+=e.length)},r.prototype.read=function(e){if(e>this._queueSize)return null;if(0===e)return n.alloc(0);this._queueSize-=e;var t,i,r=this._queue,s=e,o=r[0];if(o.length>=e)return o.length===e?r.shift():(i=o.slice(0,e),r[0]=o.slice(e),i);for(var a=0,l=r.length;a<l&&!(s<r[a].length);a++)s-=r[a].length;return t=r.splice(0,a),s>0&&r.length>0&&(t.push(r[0].slice(0,s)),r[0]=r[0].slice(s)),n.concat(t,e)},r.prototype.eachByte=function(e,t){for(var i,n,r;this._queue.length>0;){for(n=(i=this._queue[0]).length;this._offset<n;)r=this._offset,this._offset+=1,e.call(t,i[r]);this._offset=0,this._queue.shift()}},e.exports=r},1258:(e,t,i)=>{"use strict";var n=i(5433).m,r=i(892).Buffer,s={request:n.REQUEST||"request",response:n.RESPONSE||"response"},o=function(e){this._type=e,this._parser=new n(s[e]),this._complete=!1,this.headers={};var t=null,i=this;this._parser.onHeaderField=function(e,i,n){t=e.toString("utf8",i,i+n).toLowerCase()},this._parser.onHeaderValue=function(e,n,r){var s=e.toString("utf8",n,n+r);i.headers.hasOwnProperty(t)?i.headers[t]+=", "+s:i.headers[t]=s},this._parser.onHeadersComplete=this._parser[n.kOnHeadersComplete]=function(e,t,n,r,s,a){var l=arguments[0];if("object"==typeof l&&(r=l.method,s=l.url,a=l.statusCode,n=l.headers),i.method="number"==typeof r?o.METHODS[r]:r,i.statusCode=a,i.url=s,n){for(var h,c,u=0,d=n.length;u<d;u+=2)h=n[u].toLowerCase(),c=n[u+1],i.headers.hasOwnProperty(h)?i.headers[h]+=", "+c:i.headers[h]=c;i._complete=!0}}};o.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var a=process.version?process.version.match(/[0-9]+/g).map(function(e){return parseInt(e,10)}):[];0===a[0]&&12===a[1]&&(o.METHODS[16]="REPORT",o.METHODS[17]="MKACTIVITY",o.METHODS[18]="CHECKOUT",o.METHODS[19]="MERGE",o.METHODS[20]="M-SEARCH",o.METHODS[21]="NOTIFY",o.METHODS[22]="SUBSCRIBE",o.METHODS[23]="UNSUBSCRIBE",o.METHODS[24]="PATCH",o.METHODS[25]="PURGE"),o.prototype.isComplete=function(){return this._complete},o.prototype.parse=function(e){var t=this._parser.execute(e,0,e.length);if("number"!=typeof t){this.error=t,this._complete=!0;return}this._complete&&(this.body=t<e.length?e.slice(t):r.alloc(0))},e.exports=o},9242:(e,t,i)=>{"use strict";var n=i(2781).Stream,r=i(3837),s=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};r.inherits(s,n),s.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},s.prototype.resume=function(){this._paused=!1,this.emit("drain");var e=this._driver.messages;e._paused=!1,e.emit("drain")},s.prototype.write=function(e){return!!this.writable&&(this._driver.parse(e),!this._paused)},s.prototype.end=function(e){if(this.writable){void 0!==e&&this.write(e),this.writable=!1;var t=this._driver.messages;t.readable&&(t.readable=t.writable=!1,t.emit("end"))}},s.prototype.destroy=function(){this.end()};var o=function(e){this.readable=this.writable=!0,this._paused=!1,this._driver=e};r.inherits(o,n),o.prototype.pause=function(){this._driver.io._paused=!0},o.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},o.prototype.write=function(e){return!!this.writable&&("string"==typeof e?this._driver.text(e):this._driver.binary(e),!this._paused)},o.prototype.end=function(e){void 0!==e&&this.write(e)},o.prototype.destroy=function(){},t.IO=s,t.Messages=o},4432:e=>{"use strict";var t=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,i=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,n=RegExp(t.source+"(?:=(?:"+t.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),r=RegExp(t.source+"(?: *; *"+n.source+")*","g"),s=RegExp("^"+r.source+"(?: *, *"+r.source+")*$"),o=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,a=Object.prototype.hasOwnProperty,l=function(){this._byName={},this._inOrder=[]};l.prototype.push=function(e,t){a.call(this._byName,e)||(this._byName[e]=[]),this._byName[e].push(t),this._inOrder.push({name:e,params:t})},l.prototype.eachOffer=function(e,t){for(var i=this._inOrder,n=0,r=i.length;n<r;n++)e.call(t,i[n].name,i[n].params)},l.prototype.byName=function(e){return this._byName[e]||[]},l.prototype.toArray=function(){return this._inOrder.slice()},e.exports={parseHeader:function(e){var t=new l;if(""===e||void 0===e)return t;if(!s.test(e))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+e);return e.match(r).forEach(function(e){var i=e.match(RegExp(n.source,"g")),r=i.shift(),s={};i.forEach(function(e){var t,i=e.match(n),r=i[1];t=void 0!==i[2]?i[2]:void 0===i[3]||i[3].replace(/\\/g,""),o.test(t)&&(t=parseFloat(t)),a.call(s,r)?(s[r]=[].concat(s[r]),s[r].push(t)):s[r]=t},this),t.push(r,s)},this),t},serializeParams:function(e,t){var n=[],r=function(e,t){t instanceof Array?t.forEach(function(t){r(e,t)}):!0===t?n.push(e):"number"==typeof t?n.push(e+"="+t):i.test(t)?n.push(e+'="'+t.replace(/"/g,'\\"')+'"'):n.push(e+"="+t)};for(var s in t)r(s,t[s]);return[e].concat(n).join("; ")}}},6383:(e,t,i)=>{"use strict";var n=i(6251),r=i(3892),s=function(e){this._ext=e[0],this._session=e[1],this._functors={incoming:new n(this._session,"processIncomingMessage"),outgoing:new n(this._session,"processOutgoingMessage")}};s.prototype.pending=function(e){var t=this._functors[e];t._stopped||(t.pending+=1)},s.prototype.incoming=function(e,t,i,n){this._exec("incoming",e,t,i,n)},s.prototype.outgoing=function(e,t,i,n){this._exec("outgoing",e,t,i,n)},s.prototype.close=function(){return this._closed=this._closed||new r,this._doClose(),this._closed},s.prototype._exec=function(e,t,i,n,r){this._functors[e].call(t,i,function(e,t){e&&(e.message=this._ext.name+": "+e.message),n.call(r,e,t),this._doClose()},this)},s.prototype._doClose=function(){var e=this._functors.incoming,t=this._functors.outgoing;this._closed&&e.pending+t.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},e.exports=s},6251:(e,t,i)=>{"use strict";var n=i(9210),r=function(e,t){this._session=e,this._method=t,this._queue=new n(r.QUEUE_SIZE),this._stopped=!1,this.pending=0};r.QUEUE_SIZE=8,r.prototype.call=function(e,t,i,n){if(!this._stopped){var r={error:e,message:t,callback:i,context:n,done:!1},s=!1,o=this;if(this._queue.push(r),r.error)return r.done=!0,this._stop(),this._flushQueue();var a=function(e,t){s^(s=!0)&&(e?(o._stop(),r.error=e,r.message=null):r.message=t,r.done=!0,o._flushQueue())};try{this._session[this._method](t,a)}catch(e){a(e)}}},r.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},r.prototype._flushQueue=function(){for(var e,t=this._queue;t.length>0&&t.peek().done;)(e=t.shift()).error?(this.pending=0,t.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)},e.exports=r},7935:(e,t,i)=>{"use strict";var n=i(6383),r=i(3892),s=function(e){this._cells=e.map(function(e){return new n(e)}),this._stopped={incoming:!1,outgoing:!1}};s.prototype.processIncomingMessage=function(e,t,i){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,e,t,i)},s.prototype.processOutgoingMessage=function(e,t,i){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,e,t,i)},s.prototype.close=function(e,t){this._stopped={incoming:!0,outgoing:!0};var i=this._cells.map(function(e){return e.close()});e&&r.all(i).then(function(){e.call(t)})},s.prototype._loop=function(e,t,i,n,r,s,o){for(var a=this._cells,l=a.length,h=this;l--;)a[l].pending(e);var c=function(t,r,l){if(t===i)return s.call(o,r,l);a[t][e](r,l,function(i,r){i&&(h._stopped[e]=!0),c(t+n,i,r)})};c(t,null,r)},e.exports=s},3892:(e,t,i)=>{"use strict";var n=i(9210),r=function(){this._complete=!1,this._callbacks=new n(r.QUEUE_SIZE)};r.QUEUE_SIZE=4,r.all=function(e){var t=new r,i=e.length,n=i;for(0===i&&t.done();n--;)e[n].then(function(){0==(i-=1)&&t.done()});return t},r.prototype.then=function(e){this._complete?e():this._callbacks.push(e)},r.prototype.done=function(){this._complete=!0;for(var e,t=this._callbacks;e=t.shift();)e()},e.exports=r},9210:e=>{"use strict";var t=function(e){this._bufferSize=e,this.clear()};t.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},t.prototype.push=function(e){var t=!1,i=!1;this._ringSize<this._bufferSize?t=0===this._tail:this._ringOffset===this._ringSize&&(t=!0,i=0===this._tail),t&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,i&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=e,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},t.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},t.prototype.shift=function(){if(0!==this.length){var e=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,e}},e.exports=t},5056:(e,t,i)=>{"use strict";var n=i(4432),r=i(7935),s=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};s.MESSAGE_OPCODES=[1,2];var o={add:function(e){if("string"!=typeof e.name)throw TypeError("extension.name must be a string");if("permessage"!==e.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof e.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof e.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof e.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(e.name))throw TypeError('An extension with name "'+e.name+'" is already registered');this._byName[e.name]=e,this._inOrder.push(e)},generateOffer:function(){var e=[],t=[],i={};return this._inOrder.forEach(function(r){var s=r.createClientSession();if(s){var o=[r,s];e.push(o),i[r.name]=o;var a=s.generateOffer();(a=a?[].concat(a):[]).forEach(function(e){t.push(n.serializeParams(r.name,e))},this)}},this),this._sessions=e,this._index=i,t.length>0?t.join(", "):null},activate:function(e){var t=n.parseHeader(e),i=[];t.eachOffer(function(e,t){var r=this._index[e];if(!r)throw Error('Server sent an extension response for unknown extension "'+e+'"');var s=r[0],o=r[1],a=this._reserved(s);if(a)throw Error("Server sent two extension responses that use the RSV"+a[0]+' bit: "'+a[1]+'" and "'+s.name+'"');if(!0!==o.activate(t))throw Error("Server sent unacceptable extension parameters: "+n.serializeParams(e,t));this._reserve(s),i.push(r)},this),this._sessions=i,this._pipeline=new r(i)},generateResponse:function(e){var t=[],i=[],s=n.parseHeader(e);return this._inOrder.forEach(function(e){var r=s.byName(e.name);if(!(0===r.length||this._reserved(e))){var o=e.createServerSession(r);o&&(this._reserve(e),t.push([e,o]),i.push(n.serializeParams(e.name,o.generateResponse())))}},this),this._sessions=t,this._pipeline=new r(t),i.length>0?i.join(", "):null},validFrameRsv:function(e){var t,i={rsv1:!1,rsv2:!1,rsv3:!1};if(s.MESSAGE_OPCODES.indexOf(e.opcode)>=0)for(var n=0,r=this._sessions.length;n<r;n++)t=this._sessions[n][0],i.rsv1=i.rsv1||t.rsv1,i.rsv2=i.rsv2||t.rsv2,i.rsv3=i.rsv3||t.rsv3;return(i.rsv1||!e.rsv1)&&(i.rsv2||!e.rsv2)&&(i.rsv3||!e.rsv3)},processIncomingMessage:function(e,t,i){this._pipeline.processIncomingMessage(e,t,i)},processOutgoingMessage:function(e,t,i){this._pipeline.processOutgoingMessage(e,t,i)},close:function(e,t){if(!this._pipeline)return e.call(t);this._pipeline.close(e,t)},_reserve:function(e){this._rsv1=this._rsv1||e.rsv1&&e.name,this._rsv2=this._rsv2||e.rsv2&&e.name,this._rsv3=this._rsv3||e.rsv3&&e.name},_reserved:function(e){return this._rsv1&&e.rsv1?[1,this._rsv1]:this._rsv2&&e.rsv2?[2,this._rsv2]:!!this._rsv3&&!!e.rsv3&&[3,this._rsv3]}};for(var a in o)s.prototype[a]=o[a];e.exports=s},9128:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>l,metadata:()=>a});var n=i(9510);let r=(0,i(8570).createProxy)(String.raw`C:\Users\arman\Desktop\CAPSTONE\iSommelier\app\src\components\Navbar.js#default`);var s=i(7371);let o=()=>n.jsx("footer",{className:"w-full py-6 text-center bg-[#03045e] text-white",children:(0,n.jsxs)("div",{className:"max-w-screen-lg mx-auto px-4",children:[(0,n.jsxs)("p",{className:"text-sm md:text-base font-light",children:["\xa9 ",new Date().getFullYear()," ",n.jsx("span",{className:"font-semibold",children:"iSommelier"}),". All rights reserved."]}),(0,n.jsxs)("div",{className:"mt-4 flex justify-center gap-6",children:[n.jsx(s.default,{href:"/about",className:"text-sm md:text-base hover:underline",children:"About Us"}),n.jsx(s.default,{href:"/privacy",className:"text-sm md:text-base hover:underline",children:"Privacy Policy"}),n.jsx(s.default,{href:"/terms",className:"text-sm md:text-base hover:underline",children:"Terms of Service"})]})]})});i(7272);let a={title:"iSommelier",description:"Generated by create next app"};function l({children:e}){return n.jsx("html",{lang:"en",children:n.jsx("body",{children:(0,n.jsxs)("div",{className:"min-h-screen flex flex-col",children:[n.jsx(r,{}),n.jsx("main",{className:"flex-grow",children:e}),n.jsx(o,{})]})})})}},4684:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});let n=(0,i(8570).createProxy)(String.raw`C:\Users\arman\Desktop\CAPSTONE\iSommelier\app\signup\page.js#default`)},7481:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var n=i(6621);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,n.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[948,347,621],()=>i(4493));module.exports=n})();